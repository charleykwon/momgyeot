<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FDF8F3">
    
    <!-- 파비콘 및 앱 아이콘 -->
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512.png">
    
    <title>맘곁 - 엄마와 아기를 위한 AI 동반자</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* iOS Safe Area 지원 */
        html {
            height: 100%;
            height: -webkit-fill-available;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;  /* 빈 공간이 검은색으로 보이도록 */
            min-height: 100%;
            min-height: 100vh;
            min-height: 100dvh;
            min-height: -webkit-fill-available;
            overflow: hidden;
            /* PWA 전체화면 지원 */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* 풀스크린 - 아이폰 프레임 제거 */
        .iphone-frame {
            display: contents;
        }
        
        .notch {
            display: none;
        }
        
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            height: 100vh;
            height: 100dvh;
            height: -webkit-fill-available;
            background: #FDF8F3;
            overflow: hidden;
        }
        
        .home-indicator {
            display: none;
        }
        
        /* 화면 전환 */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: opacity 0.3s, transform 0.3s;
        }
        
        .page.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateX(20px);
        }
        
        /* ==================== 인트로 화면 ==================== */
        .intro-screen {
            background: #000;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            height: 100dvh !important;
            height: -webkit-fill-available !important;
            z-index: 100;
        }
        
        .intro-bg {
            position: fixed;
            top: -50px;
            left: -50px;
            right: -50px;
            bottom: -50px;
            width: calc(100% + 100px);
            height: calc(100% + 100px);
            overflow: hidden;
        }
        
        .intro-bg img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center center;
            transform: scale(1.3);
            animation: slowZoom 25s ease-in-out infinite alternate;
        }
        
        @keyframes slowZoom {
            0% { transform: scale(1.3) translateY(0); }
            100% { transform: scale(1.4) translateY(-3%); }
        }
        
        .intro-overlay {
            position: fixed;
            top: -50px;
            left: -50px;
            right: -50px;
            bottom: -50px;
            width: calc(100% + 100px);
            height: calc(100% + 100px);
            background: linear-gradient(180deg,
                rgba(0, 0, 0, 0.1) 0%,
                rgba(0, 0, 0, 0.2) 30%,
                rgba(0, 0, 0, 0.5) 70%,
                rgba(0, 0, 0, 0.7) 100%
            );
        }
        
        .intro-content {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 24px;
            padding-top: calc(24px + env(safe-area-inset-top, 0px));
            padding-bottom: calc(45px + env(safe-area-inset-bottom, 0px));
            z-index: 10;
            text-align: center;
        }
        
        .intro-logo {
            margin-bottom: 24px;
            opacity: 0;
            animation: fadeInDown 1s ease 0.3s forwards;
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .intro-logo-icon {
            width: 56px;
            height: 56px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            
            
            
            font-size: 28px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            margin: 0 auto 12px;
        }
        
        .intro-brand {
            font-size: 12px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: 2px;
        }
        
        .intro-headline h1 {
            font-size: 26px;
            font-weight: 700;
            color: #FFFFFF;
            line-height: 1.6;
            margin-bottom: 16px;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }
        
        .intro-headline h1 span.highlight {
            color: #E8B4B8;
        }
        
        /* 타이핑 효과 */
        .typing-line {
            display: block;
            overflow: hidden;
            white-space: nowrap;
            width: 0;
            opacity: 0;
        }
        
        .typing-line.line1 {
            animation: typing 1.2s steps(12) 1s forwards, blink 0.5s step-end 1s 2;
        }
        
        .typing-line.line2 {
            animation: typing 1.2s steps(12) 2.4s forwards, blink 0.5s step-end 2.4s 2;
        }
        
        .typing-line.line3 {
            animation: typing 1.5s steps(15) 3.8s forwards;
        }
        
        @keyframes typing {
            from {
                width: 0;
                opacity: 1;
            }
            to {
                width: 100%;
                opacity: 1;
            }
        }
        
        @keyframes blink {
            50% { border-color: transparent; }
        }
        
        /* 서브 카피 - 마음 효과 */
        .intro-subtitle {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.85);
            line-height: 1.8;
            margin-bottom: 32px;
            text-shadow: 0 1px 10px rgba(0, 0, 0, 0.3);
            opacity: 0;
            animation: heartFadeIn 2s ease 5.5s forwards;
        }
        
        .intro-subtitle .heart-text {
            display: inline-block;
            animation: heartBeat 1.5s ease-in-out 6.5s infinite;
        }
        
        @keyframes heartFadeIn {
            0% {
                opacity: 0;
                transform: translateY(20px) scale(0.9);
            }
            50% {
                opacity: 0.5;
                transform: translateY(10px) scale(0.95);
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes heartBeat {
            0%, 100% {
                transform: scale(1);
            }
            15% {
                transform: scale(1.05);
            }
            30% {
                transform: scale(1);
            }
            45% {
                transform: scale(1.03);
            }
        }
        
        .intro-cta {
            margin-bottom: 24px;
            opacity: 0;
            animation: fadeInUp 1s ease 7s forwards;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .intro-btn {
            display: inline-flex;
            
            gap: 10px;
            padding: 18px 40px;
            background: #E8B4B8;
            color: #3D4A2D;
            border: none;
            border-radius: 32px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(232, 180, 184, 0.4);
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .intro-btn:hover {
            background: #F0C4C8;
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(232, 180, 184, 0.5);
        }
        
        .intro-footer {
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            opacity: 0;
            animation: fadeIn 1s ease 7.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        /* ==================== 로그인 화면 ==================== */
        .login-screen {
            background: #FDF8F5;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .login-header {
            padding: 28px;
            padding-top: calc(28px + env(safe-area-inset-top, 44px));
            flex: 1;
        }
        
        .back-btn {
            width: 40px;
            height: 40px;
            background: rgba(94, 107, 58, 0.1);
            border: none;
            border-radius: 50%;
            
            
            
            cursor: pointer;
            margin-bottom: 40px;
            font-size: 18px;
            color: #5E6B3A;
        }
        
        .login-logo {
            margin-bottom: 32px;
        }
        
        .login-logo-icon {
            width: 64px;
            height: 64px;
            background: #fff;
            border-radius: 20px;
            
            
            
            font-size: 32px;
            box-shadow: 0 4px 20px rgba(94, 107, 58, 0.15);
            margin-bottom: 16px;
        }
        
        .login-title {
            font-size: 24px;
            font-weight: 700;
            color: #3D4A2D;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .login-desc {
            font-size: 14px;
            color: #8A8A8A;
        }
        
        .login-buttons {
            padding: 28px;
            padding-bottom: 48px;
        }
        
        .login-btn {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            
            
            
            gap: 12px;
            margin-bottom: 12px;
            border: none;
            font-family: inherit;
            transition: all 0.2s;
        }
        
        .login-btn:hover {
            transform: translateY(-1px);
        }
        
        .login-btn-kakao {
            background: #FEE500;
            color: #000;
        }
        
        .login-btn-google {
            background: #fff;
            color: #333;
            border: 1px solid #E0E0E0;
        }
        
        .login-btn-apple {
            background: #000;
            color: #fff;
        }
        
        .divider {
            
            
            gap: 16px;
            margin: 20px 0;
        }
        
        .divider-line {
            flex: 1;
            height: 1px;
            background: #E0E0E0;
        }
        
        .divider-text {
            font-size: 12px;
            color: #8A8A8A;
        }
        
        .login-btn-guest {
            background: rgba(94, 107, 58, 0.1);
            color: #5E6B3A;
        }
        
        /* 버튼 아이콘 */
        .btn-icon {
            width: 20px;
            height: 20px;
        }
        
        /* ==================== 홈 화면 ==================== */
        .home-screen {
            background: #FDF8F5;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .home-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            padding-top: calc(20px + env(safe-area-inset-top, 44px));
        }
        
        .home-greeting {
            
            
            gap: 12px;
        }
        
        .greeting-emoji {
            font-size: 32px;
        }
        
        .greeting-text {
            font-size: 14px;
            color: #8A8A8A;
        }
        
        .greeting-name {
            font-size: 18px;
            font-weight: 700;
            color: #3D4A2D;
        }
        
        .home-icons {
            
            gap: 8px;
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .home-content {
            flex: 1;
            padding: 0 20px;
            overflow-y: auto;
            padding-bottom: calc(80px + max(12px, env(safe-area-inset-bottom, 0px)));
        }
        
        .section-title {
            font-size: 22px;
            font-weight: 700;
            color: #3D4A2D;
            margin-bottom: 4px;
        }
        
        .section-desc {
            font-size: 14px;
            color: #8A8A8A;
            margin-bottom: 20px;
        }
        
        .mate-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .mate-card {
            background: white;
            border-radius: 20px;
            padding: 20px 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            position: relative;
        }
        
        .mate-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(94, 107, 58, 0.15);
        }
        
        .mate-tag {
            position: absolute;
            top: 12px;
            left: 12px;
            font-size: 10px;
            font-weight: 600;
            color: #5E6B3A;
            background: rgba(94, 107, 58, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
        }
        
        .mate-icon {
            font-size: 40px;
            margin-bottom: 12px;
            margin-top: 8px;
        }
        
        .mate-card h3 {
            font-size: 16px;
            font-weight: 700;
            color: #3D4A2D;
            margin-bottom: 6px;
        }
        
        .mate-card p {
            font-size: 12px;
            color: #8A8A8A;
            line-height: 1.4;
        }
        
        /* 하단 네비게이션 */
        .bottom-nav {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: stretch;
            align-items: flex-start;
            padding-top: 12px;
            padding-bottom: 12px;
            padding-bottom: max(12px, env(safe-area-inset-bottom, 0px));
            border-top: 1px solid #f0f0f0;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            gap: 4px;
            background: none;
            border: none;
            cursor: pointer;
            color: #BDBDBD;
            transition: color 0.2s;
            flex: 1;
            padding: 0;
        }
        
        .nav-item.active {
            color: #5E6B3A;
        }
        
        .nav-item span {
            font-size: 11px;
            font-weight: 500;
        }
        
        /* ==================== 온보딩 화면 ==================== */
        .onboarding-screen {
            background: #FDF8F3;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .onboarding-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            padding-top: calc(16px + env(safe-area-inset-top, 44px));
            background: #FDF8F3;
        }
        
        .onboarding-progress {
            font-size: 14px;
            font-weight: 600;
            color: #5E6B3A;
            background: rgba(94, 107, 58, 0.1);
            padding: 6px 16px;
            border-radius: 20px;
        }
        
        .onboarding-content {
            flex: 1;
            padding: 20px 24px;
            
            flex-direction: column;
            overflow-y: auto;
        }
        
        .onboarding-question {
            margin-bottom: 32px;
        }
        
        .onboarding-question h2 {
            font-size: 24px;
            font-weight: 700;
            color: #3D4A2D;
            line-height: 1.4;
            margin-bottom: 8px;
        }
        
        .onboarding-question p {
            font-size: 14px;
            color: #666;
        }
        
        .onboarding-options {
            
            flex-direction: column;
            gap: 12px;
        }
        
        .onboarding-option {
            
            
            gap: 14px;
            padding: 18px 20px;
            background: white;
            border: 2px solid #E8E8E8;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-family: inherit;
        }
        
        .onboarding-option:hover {
            border-color: #5E6B3A;
            background: rgba(94, 107, 58, 0.03);
        }
        
        .onboarding-option.selected {
            border-color: #5E6B3A;
            background: rgba(94, 107, 58, 0.08);
        }
        
        .onboarding-option .option-icon {
            font-size: 24px;
        }
        
        .onboarding-option .option-text {
            flex: 1;
        }
        
        .onboarding-option .option-text strong {
            display: block;
            font-size: 16px;
            font-weight: 600;
            color: #3D4A2D;
            margin-bottom: 2px;
        }
        
        .onboarding-option .option-text span {
            font-size: 13px;
            color: #888;
        }
        
        .onboarding-input-row {
            display: flex;
            gap: 12px;
            align-items: center;
            width: 100%;
        }
        
        .onboarding-input {
            flex: 1;
            padding: 18px 24px;
            border: 2px solid #D0D0D0;
            border-radius: 28px;
            font-size: 17px;
            font-family: inherit;
            transition: all 0.3s;
            background: #FAFAFA;
        }
        
        .onboarding-input:focus {
            outline: none;
            border-color: #5E6B3A;
            background: white;
            box-shadow: 0 0 0 4px rgba(94, 107, 58, 0.1);
        }
        
        .onboarding-input::placeholder {
            color: #AAA;
        }
        
        .onboarding-next-btn {
            padding: 18px 24px;
            background: #5E6B3A;
            color: white;
            border: none;
            border-radius: 28px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .onboarding-next-btn:hover {
            background: #4A5530;
            transform: translateY(-1px);
        }
        
        .onboarding-next-btn:disabled {
            background: #CCC;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ==================== 채팅 화면 ==================== */
        .chat-screen {
            background: #FDF8F5;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            padding-top: calc(16px + env(safe-area-inset-top, 44px));
            background: white;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .chat-title {
            
            
            gap: 8px;
            font-size: 17px;
            font-weight: 600;
            color: #3D4A2D;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .message {
            display: flex;
            gap: 10px;
            max-width: 85%;
            margin-bottom: 16px;
        }
        
        .message.bot {
            align-self: flex-start;
        }
        
        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 50%;
            
            
            
            font-size: 18px;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .message-content {
            background: white;
            padding: 12px 16px;
            border-radius: 18px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        
        .message.user .message-content {
            background: #5E6B3A;
            color: white;
        }
        
        .message-content p {
            font-size: 14px;
            line-height: 1.5;
            margin: 0;
        }
        
        .message-content p + p {
            margin-top: 6px;
        }
        
        .chat-input-area {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 16px;
            padding-bottom: calc(12px + env(safe-area-inset-bottom, 20px));
            background: white;
            border-top: 1px solid #f0f0f0;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #E8E8E8;
            border-radius: 24px;
            font-size: 15px;
            outline: none;
            font-family: inherit;
        }
        
        .chat-input:focus {
            border-color: #5E6B3A;
        }
        
        .send-btn {
            width: 44px;
            height: 44px;
            background: #5E6B3A;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            flex-shrink: 0;
        }
        
        .send-btn:hover {
            background: #3D4A2D;
        }
        
        /* 마이크 버튼 */
        .mic-btn {
            width: 48px;
            height: 48px;
            background: #3D3D3D;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .mic-btn:hover {
            background: #4a4a4a;
            transform: scale(1.05);
        }
        
        .mic-btn.recording {
            background: #5E6B3A;
            animation: pulse-mic 1.5s infinite;
        }
        
        @keyframes pulse-mic {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(94, 107, 58, 0.4); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 12px rgba(94, 107, 58, 0); }
        }
        
        /* 음파 아이콘 - 세로 바 3개 */
        .sound-wave {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
            height: 24px;
        }
        
        .sound-wave .bar {
            width: 3px;
            background: white;
            border-radius: 2px;
            transition: height 0.15s ease;
        }
        
        .sound-wave .bar:nth-child(1) { height: 10px; }
        .sound-wave .bar:nth-child(2) { height: 18px; }
        .sound-wave .bar:nth-child(3) { height: 10px; }
        
        .mic-btn.recording .sound-wave .bar {
            animation: wave-bar 0.5s ease-in-out infinite;
        }
        
        .mic-btn.recording .sound-wave .bar:nth-child(1) { animation-delay: 0s; }
        .mic-btn.recording .sound-wave .bar:nth-child(2) { animation-delay: 0.15s; }
        .mic-btn.recording .sound-wave .bar:nth-child(3) { animation-delay: 0.3s; }
        
        @keyframes wave-bar {
            0%, 100% { height: 10px; }
            50% { height: 20px; }
        }
        
        /* 녹음 중 인디케이터 */
        .recording-indicator {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(94, 107, 58, 0.95);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            white-space: nowrap;
            margin-bottom: 10px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            
            
            gap: 8px;
        }
        
        .recording-indicator.active {
            opacity: 1;
            visibility: visible;
        }
        
        .recording-indicator::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(94, 107, 58, 0.95);
        }
        
        .recording-dot {
            width: 8px;
            height: 8px;
            background: #FF6B6B;
            border-radius: 50%;
            animation: blink-dot 1s infinite;
        }
        
        @keyframes blink-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        /* 채팅 입력 영역 수정 */
        .chat-input-area {
            position: relative;
        }
        
        /* ==================== 공통 헤더 ==================== */
        .screen-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            padding-top: calc(16px + env(safe-area-inset-top, 44px));
            background: white;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .screen-title {
            font-size: 18px;
            font-weight: 600;
            color: #3D4A2D;
        }
        
        .menu-btn {
            width: 40px;
            height: 40px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #5E6B3A;
        }
        
        /* ==================== 캘린더 화면 ==================== */
        .calendar-screen {
            background: #FDF8F5;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .calendar-content {
            flex: 1;
            padding: 20px 16px;
            overflow-y: auto;
            padding-bottom: calc(100px + env(safe-area-inset-bottom, 0px));
        }
        
        .calendar-nav {
            
            
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .calendar-nav button {
            width: 36px;
            height: 36px;
            background: white;
            border: none;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            color: #5E6B3A;
        }
        
        .calendar-month {
            font-size: 18px;
            font-weight: 600;
            color: #3D4A2D;
        }
        
        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            margin-bottom: 10px;
        }
        
        .calendar-weekdays span {
            font-size: 12px;
            color: #8A8A8A;
            padding: 8px 0;
        }
        
        .calendar-weekdays span:first-child { color: #E8B4B8; }
        .calendar-weekdays span:last-child { color: #5E6B3A; }
        
        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            margin-bottom: 24px;
        }
        
        .calendar-day {
            position: relative;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .calendar-day:hover { background: rgba(94, 107, 58, 0.1); }
        .calendar-day.today { background: #5E6B3A; color: white; font-weight: 600; }
        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 5px;
            background: #E8B4B8;
            border-radius: 50%;
        }
        
        .calendar-events h3 {
            font-size: 16px;
            font-weight: 600;
            color: #3D4A2D;
            margin-bottom: 12px;
        }
        
        .event-item {
            
            
            gap: 12px;
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        .event-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }
        
        .event-title {
            font-size: 14px;
            font-weight: 500;
            color: #3D4A2D;
        }
        
        .event-time {
            font-size: 12px;
            color: #8A8A8A;
            margin-top: 2px;
        }
        
        /* ==================== 마이페이지 화면 ==================== */
        .my-screen {
            background: #FDF8F5;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .my-content {
            flex: 1;
            padding: 20px 16px;
            overflow-y: auto;
            padding-bottom: calc(100px + env(safe-area-inset-bottom, 0px));
        }
        
        .profile-section {
            
            
            gap: 16px;
            background: white;
            padding: 0;
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #E8B4B8, #F0D0D3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-info h2 {
            font-size: 18px;
            font-weight: 600;
            color: #3D4A2D;
        }
        
        .profile-info p {
            font-size: 13px;
            color: #8A8A8A;
            margin-top: 4px;
        }
        
        .profile-info strong { color: #5E6B3A; }
        
        .edit-btn {
            padding: 8px 16px;
            background: rgba(94, 107, 58, 0.1);
            border: none;
            border-radius: 20px;
            color: #5E6B3A;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .my-stats {
            
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .stat-item {
            flex: 1;
            background: white;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        .stat-num {
            display: block;
            font-size: 24px;
            font-weight: 700;
            color: #5E6B3A;
        }
        
        .stat-label {
            font-size: 12px;
            color: #8A8A8A;
        }
        
        .my-menu-list {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
        }
        
        .my-menu-item {
            
            
            width: 100%;
            padding: 16px 20px;
            background: none;
            border: none;
            border-bottom: 1px solid #f5f5f5;
            cursor: pointer;
            text-align: left;
            font-size: 15px;
            color: #3D4A2D;
            gap: 12px;
        }
        
        .my-menu-item:last-child { border-bottom: none; }
        .menu-icon { font-size: 18px; }
        .menu-arrow { margin-left: auto; color: #BDBDBD; }
        
        /* ==================== 알림 화면 ==================== */
        .notification-screen {
            background: #FDF8F5;
            
            flex-direction: column;
        }
        
        .noti-content {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }
        
        .noti-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            background: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            text-decoration: none;
            color: inherit;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .noti-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .noti-item:active {
            transform: scale(0.98);
        }
        
        .noti-item.unread {
            background: linear-gradient(135deg, #fff 0%, #f8fff5 100%);
            border-left: 3px solid #5E6B3A;
        }
        
        .noti-icon {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .noti-info {
            flex: 1;
        }
        
        .noti-title {
            font-size: 14px;
            font-weight: 500;
            color: #3D4A2D;
        }
        
        .noti-desc {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }
        
        .noti-time {
            font-size: 11px;
            color: #BDBDBD;
            margin-top: 6px;
        }
        
        /* ==================== 전문가 연결 화면 ==================== */
        .expert-screen {
            display: flex;
            flex-direction: column;
            background: #FDF8F3;
        }
        
        .expert-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 60px 20px 20px;
            background: #FDF8F3;
        }
        
        .expert-header h1 {
            font-size: 18px;
            font-weight: 600;
            color: #3D4A2D;
        }
        
        .expert-content {
            flex: 1;
            padding: 0 20px 20px;
            overflow-y: auto;
            padding-bottom: calc(80px + max(12px, env(safe-area-inset-bottom, 0px)));
        }
        
        .expert-intro {
            text-align: center;
            padding: 30px 0 40px;
        }
        
        .expert-icon {
            font-size: 60px;
            margin-bottom: 16px;
        }
        
        .expert-intro h2 {
            font-size: 22px;
            font-weight: 700;
            color: #3D4A2D;
            margin-bottom: 8px;
        }
        
        .expert-intro p {
            font-size: 15px;
            color: #8A8A8A;
            line-height: 1.5;
        }
        
        .expert-options {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 30px;
        }
        
        .expert-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.06);
            text-decoration: none;
            color: inherit;
            border: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .expert-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        .expert-card.kakao {
            border-color: #FEE500;
            background: linear-gradient(135deg, #FFFEF5, white);
        }
        
        .expert-card.reservation {
            border-color: #E8B4B8;
            background: linear-gradient(135deg, #FFF9F9, white);
        }
        
        .expert-card-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border-radius: 12px;
            background: #F5F5F5;
        }
        
        .expert-card.kakao .expert-card-icon {
            background: #FEE500;
        }
        
        .expert-card.reservation .expert-card-icon {
            background: #FCE4E8;
        }
        
        .expert-card-content {
            flex: 1;
        }
        
        .expert-card-content h3 {
            font-size: 17px;
            font-weight: 600;
            color: #3D4A2D;
            margin-bottom: 4px;
        }
        
        .expert-card-content p {
            font-size: 13px;
            color: #8A8A8A;
            margin-bottom: 6px;
        }
        
        .expert-card-tag {
            display: inline-block;
            font-size: 11px;
            color: #5E6B3A;
            background: rgba(94, 107, 58, 0.1);
            padding: 3px 8px;
            border-radius: 10px;
        }
        
        .expert-card-arrow {
            font-size: 20px;
            color: #BDBDBD;
        }
        
        .expert-info {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }
        
        .expert-info h4 {
            font-size: 15px;
            font-weight: 600;
            color: #3D4A2D;
            margin-bottom: 12px;
        }
        
        .expert-info ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .expert-info li {
            font-size: 14px;
            color: #666;
            padding: 8px 0;
            border-bottom: 1px solid #F0F0F0;
            padding-left: 20px;
            position: relative;
        }
        
        .expert-info li:last-child {
            border-bottom: none;
        }
        
        .expert-info li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #5E6B3A;
            font-weight: bold;
        }
        
        /* ==================== 상담 예약 모달 ==================== */
        .reservation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .reservation-modal.hidden {
            display: none;
        }
        
        .reservation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }
        
        .reservation-content {
            position: relative;
            width: 90%;
            max-width: 400px;
            max-height: 85vh;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            animation: modalSlideUp 0.3s ease;
        }
        
        @keyframes modalSlideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .reservation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            border-bottom: 1px solid #F0F0F0;
        }
        
        .reservation-header h2 {
            font-size: 18px;
            font-weight: 600;
            color: #3D4A2D;
        }
        
        .close-modal-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #F5F5F5;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            color: #666;
        }
        
        .reservation-body {
            padding: 20px;
            max-height: calc(85vh - 80px);
            overflow-y: auto;
        }
        
        .reservation-notice {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: linear-gradient(135deg, #FFF9F0, #FFF5E8);
            border-radius: 12px;
            margin-bottom: 24px;
            border: 1px solid #F5E6D3;
        }
        
        .notice-icon {
            font-size: 32px;
        }
        
        .reservation-notice p {
            font-size: 14px;
            color: #5D4E37;
            line-height: 1.5;
        }
        
        .reservation-notice strong {
            color: #5E6B3A;
            font-weight: 700;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #3D4A2D;
            margin-bottom: 8px;
        }
        
        .form-group .required {
            color: #E8B4B8;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #E0E0E0;
            border-radius: 12px;
            font-size: 15px;
            color: #333;
            background: #FAFAFA;
            transition: all 0.2s;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #5E6B3A;
            background: white;
            box-shadow: 0 0 0 3px rgba(94, 107, 58, 0.1);
        }
        
        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #BDBDBD;
        }
        
        .form-group select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }
        
        .form-group textarea {
            resize: none;
            font-family: inherit;
        }
        
        .reservation-submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #5E6B3A, #7A8B4A);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }
        
        .reservation-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(94, 107, 58, 0.3);
        }
        
        .reservation-submit-btn:disabled {
            background: #BDBDBD;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .reservation-footer {
            text-align: center;
            font-size: 12px;
            color: #999;
            margin-top: 16px;
        }
        
        /* ==================== 사이드 메뉴 ==================== */
        .side-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 200;
        }
        
        .side-menu.hidden { display: none; }
        
        .side-menu-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
        }
        
        .side-menu-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 280px;
            height: 100%;
            background: white;
            border-radius: 0 24px 24px 0;
            overflow: hidden;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        .side-menu-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 60px 20px 20px;
            background: linear-gradient(135deg, #5E6B3A, #7A8B4A);
            color: white;
        }
        
        .side-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .side-avatar {
            width: 48px;
            height: 48px;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
        }
        
        .side-name {
            font-size: 16px;
            font-weight: 600;
        }
        
        .side-email {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .close-menu-btn {
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }
        
        .side-menu-list {
            padding: 16px 0;
        }
        
        .side-menu-item {
            display: flex;
            align-items: center;
            gap: 14px;
            width: 100%;
            padding: 14px 24px;
            background: none;
            border: none;
            font-size: 15px;
            color: #3D4A2D;
            cursor: pointer;
            text-align: left;
            text-decoration: none;
            font-family: inherit;
        }
        
        .side-menu-item:hover {
            background: rgba(94, 107, 58, 0.08);
        }
        
        .side-icon { font-size: 18px; }
        
        .side-divider {
            height: 1px;
            background: #FDF8F3;
            margin: 12px 24px;
        }
        
        /* ==================== RAG 응답 스타일 ==================== */
        .typing-indicator {
            color: #8A8A8A;
            font-style: italic;
        }
        
        .typing-indicator .dots {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .answer-title {
            color: #5E6B3A;
            font-size: 15px;
            margin-bottom: 8px !important;
        }
        
        .related-topics {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #f0f0f0;
        }
        
        .related-label {
            font-size: 12px;
            color: #8A8A8A;
            margin-bottom: 8px !important;
        }
        
        .related-btn {
            display: inline-block;
            padding: 6px 12px;
            margin: 4px 4px 4px 0;
            background: #F0F2E8;
            border: 1px solid #D5DAC7;
            border-radius: 16px;
            font-size: 12px;
            color: #5E6B3A;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .related-btn:hover {
            background: #5E6B3A;
            color: white;
            border-color: #5E6B3A;
        }
        
        .related-btn:active {
            transform: scale(0.95);
        }
        
        /* ==================== 설정 화면 ==================== */
        .settings-screen {
            background: #F5F5F5;
        }
        
        .settings-content {
            padding: 16px;
            padding-bottom: 100px;
            overflow-y: auto;
            height: calc(100% - 60px);
        }
        
        .settings-section {
            background: white;
            border-radius: 16px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .settings-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #888;
            padding: 16px 16px 8px;
        }
        
        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            border-bottom: 1px solid #F0F0F0;
        }
        
        .settings-item:last-child {
            border-bottom: none;
        }
        
        .settings-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .settings-icon {
            font-size: 22px;
        }
        
        .settings-item-title {
            font-size: 15px;
            font-weight: 500;
            color: #333;
        }
        
        .settings-item-desc {
            font-size: 12px;
            color: #888;
            margin-top: 2px;
        }
        
        /* 토글 스위치 */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #E0E0E0;
            transition: 0.3s;
            border-radius: 28px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: #5E6B3A;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        /* ==================== 약관 화면 ==================== */
        .policy-screen {
            background: #FDF8F3;
        }
        
        .policy-content {
            padding: 20px;
            padding-bottom: 40px;
            overflow-y: auto;
            height: calc(100% - 60px);
            font-size: 14px;
            line-height: 1.8;
            color: #333;
        }
        
        .policy-loading {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }
        
        .policy-content h2 {
            font-size: 18px;
            font-weight: 700;
            color: #3D4A2D;
            margin: 24px 0 12px;
        }
        
        .policy-content h2:first-child {
            margin-top: 0;
        }
        
        .policy-content h3 {
            font-size: 15px;
            font-weight: 600;
            color: #5E6B3A;
            margin: 20px 0 10px;
        }
        
        .policy-content p {
            margin-bottom: 12px;
        }
        
        .policy-content ul {
            margin: 12px 0;
            padding-left: 20px;
        }
        
        .policy-content li {
            margin-bottom: 8px;
        }
        
        .policy-updated {
            font-size: 12px;
            color: #888;
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #E0E0E0;
        }
        
        /* ==================== 다크모드 ==================== */
        body.dark-mode .screen {
            background: #1A1A1A;
        }
        
        body.dark-mode .home-screen,
        body.dark-mode .my-screen,
        body.dark-mode .calendar-screen,
        body.dark-mode .settings-screen,
        body.dark-mode .policy-screen {
            background: #1A1A1A;
        }
        
        body.dark-mode .screen-header {
            background: #252525;
            border-bottom-color: #333;
        }
        
        body.dark-mode .screen-title,
        body.dark-mode .menu-btn,
        body.dark-mode .back-btn {
            color: #F0F0F0;
        }
        
        body.dark-mode .bottom-nav {
            background: #252525;
            border-top-color: #333;
        }
        
        body.dark-mode .nav-item {
            color: #888;
        }
        
        body.dark-mode .nav-item.active {
            color: #8A9B5A;
        }
        
        body.dark-mode .greeting-card {
            background: linear-gradient(135deg, #3D4A2D, #4A5530);
        }
        
        body.dark-mode .mate-card {
            background: #252525;
        }
        
        body.dark-mode .mate-name {
            color: #F0F0F0;
        }
        
        body.dark-mode .mate-desc {
            color: #888;
        }
        
        body.dark-mode .quick-menu {
            background: #252525;
        }
        
        body.dark-mode .quick-item span {
            color: #F0F0F0;
        }
        
        body.dark-mode .settings-section {
            background: #252525;
        }
        
        body.dark-mode .settings-section-title {
            color: #888;
        }
        
        body.dark-mode .settings-item {
            border-bottom-color: #333;
        }
        
        body.dark-mode .settings-item-title {
            color: #F0F0F0;
        }
        
        body.dark-mode .settings-item-desc {
            color: #888;
        }
        
        body.dark-mode .policy-content {
            color: #E0E0E0;
        }
        
        body.dark-mode .policy-content h2 {
            color: #8A9B5A;
        }
        
        body.dark-mode .policy-content h3 {
            color: #A0B06A;
        }
        
        body.dark-mode .my-content {
            background: #1A1A1A;
        }
        
        body.dark-mode .profile-section {
            background: #252525;
        }
        
        body.dark-mode .profile-info h2,
        body.dark-mode .profile-info p {
            color: #F0F0F0;
        }
        
        body.dark-mode .my-stats {
            background: #252525;
        }
        
        body.dark-mode .stat-item {
            background: #333;
        }
        
        body.dark-mode .stat-num {
            color: #8A9B5A;
        }
        
        body.dark-mode .stat-label {
            color: #999;
        }
        
        body.dark-mode .my-menu-list {
            background: #252525;
        }
        
        body.dark-mode .my-menu-item {
            background: #252525;
            color: #F0F0F0;
        }
        
        body.dark-mode .my-menu-item:hover {
            background: #333;
        }
        
        body.dark-mode .chat-screen {
            background: #1A1A1A;
        }
        
        body.dark-mode .chat-header {
            background: #252525;
            border-bottom-color: #333;
        }
        
        body.dark-mode .chat-title span {
            color: #F0F0F0;
        }
        
        body.dark-mode .chat-messages {
            background: #1A1A1A;
        }
        
        body.dark-mode .message.bot .message-content {
            background: #252525;
            color: #E0E0E0;
        }
        
        body.dark-mode .message.user .message-content {
            background: #4A5530;
        }
        
        body.dark-mode .chat-input-area {
            background: #252525;
            border-top-color: #333;
        }
        
        body.dark-mode .chat-input {
            background: #1A1A1A;
            color: #F0F0F0;
            border-color: #333;
        }
        
        /* 캘린더 다크모드 */
        body.dark-mode .calendar-content {
            background: #1A1A1A;
        }
        
        body.dark-mode .calendar-nav button {
            background: #333;
            color: #F0F0F0;
            border-color: #444;
        }
        
        body.dark-mode .calendar-month {
            color: #A0B06A;
        }
        
        body.dark-mode .calendar-weekdays span {
            color: #AAA;
        }
        
        body.dark-mode .calendar-weekdays span:first-child { 
            color: #E8A0A8; 
        }
        
        body.dark-mode .calendar-weekdays span:last-child { 
            color: #8A9B5A; 
        }
        
        body.dark-mode .calendar-day {
            color: #E0E0E0;
        }
        
        body.dark-mode .calendar-day:hover {
            background: rgba(138, 155, 90, 0.2);
        }
        
        body.dark-mode .calendar-day.today {
            background: #5E6B3A;
            color: #FFFFFF;
        }
        
        body.dark-mode .calendar-events {
            background: #1A1A1A;
        }
        
        body.dark-mode .calendar-events h3 {
            color: #8A9B5A;
        }
        
        body.dark-mode .event-item {
            background: #252525;
            border-left-color: #E8B4B8;
        }
        
        body.dark-mode .event-title {
            color: #F0F0F0;
        }
        
        body.dark-mode .event-time {
            color: #999;
        }
        
        /* 사이드 메뉴 다크모드 */
        body.dark-mode .side-menu-content {
            background: #252525;
        }
        
        body.dark-mode .side-menu-header {
            background: linear-gradient(135deg, #3D4A2D, #4A5530);
        }
        
        body.dark-mode .side-menu-item {
            color: #E0E0E0;
            border-bottom-color: #333;
        }
        
        body.dark-mode .side-menu-item:hover {
            background: #333;
        }
        
        /* 알림 화면 다크모드 */
        body.dark-mode .notification-screen {
            background: #1A1A1A;
        }
        
        body.dark-mode .notification-item {
            background: #252525;
            border-bottom-color: #333;
        }
        
        body.dark-mode .notification-item h4 {
            color: #F0F0F0;
        }
        
        body.dark-mode .notification-item p {
            color: #999;
        }
        
        /* 전문가 화면 다크모드 */
        body.dark-mode .expert-screen {
            background: #1A1A1A;
        }
        
        body.dark-mode .expert-card {
            background: #252525;
        }
        
        body.dark-mode .expert-name {
            color: #F0F0F0;
        }
        
        body.dark-mode .expert-title {
            color: #8A9B5A;
        }
        
        body.dark-mode .expert-desc {
            color: #999;
        }
        
        /* 온보딩 다크모드 */
        body.dark-mode .onboarding-screen {
            background: #1A1A1A;
        }
        
        body.dark-mode .onboarding-question {
            color: #F0F0F0;
        }
        
        body.dark-mode .onboarding-subtitle {
            color: #999;
        }
        
        body.dark-mode .onboarding-option {
            background: #252525;
            border-color: #444;
            color: #F0F0F0;
        }
        
        body.dark-mode .onboarding-option:hover {
            border-color: #8A9B5A;
            background: #333;
        }
        
        body.dark-mode .onboarding-input {
            background: #2A2A2A;
            border-color: #444;
            color: #F0F0F0;
        }
        
        body.dark-mode .onboarding-input:focus {
            border-color: #8A9B5A;
            background: #333;
            box-shadow: 0 0 0 4px rgba(138, 155, 90, 0.2);
        }
        
        /* 추가 다크모드 - 아이콘 버튼 */
        body.dark-mode .icon-btn {
            background: #333;
            color: #F0F0F0;
        }
        
        /* 추가 다크모드 - 섹션 타이틀 */
        body.dark-mode .section-title {
            color: #F0F0F0;
        }
        
        body.dark-mode .section-desc {
            color: #999;
        }
        
        /* 추가 다크모드 - 로그인 화면 */
        body.dark-mode .login-screen {
            background: linear-gradient(180deg, #1A1A1A 0%, #252525 100%);
        }
        
        body.dark-mode .login-logo-icon {
            background: #333;
        }
        
        body.dark-mode .login-title {
            color: #F0F0F0;
        }
        
        body.dark-mode .login-subtitle {
            color: #999;
        }
        
        body.dark-mode .login-btn {
            background: #333;
            color: #F0F0F0;
        }
        
        body.dark-mode .login-btn:hover {
            background: #444;
        }
        
        /* 추가 다크모드 - 편집/수정 버튼 */
        body.dark-mode .edit-btn {
            color: #8A9B5A;
        }
        
        /* 추가 다크모드 - 프로필 닉네임 */
        body.dark-mode .profile-nickname {
            color: #F0F0F0;
        }
        
        body.dark-mode .profile-days {
            color: #8A9B5A;
        }
    </style>
</head>
<body>
    <div class="iphone-frame">
        <div class="notch"></div>
        
        <div class="screen">
            <!-- 인트로 화면 -->
            <div class="page intro-screen" id="introScreen">
                <div class="intro-bg">
                    <img src="intro-bg.png" alt="배경">
                </div>
                <div class="intro-overlay"></div>
                
                <div class="intro-content">
                    <div class="intro-logo">
                        <div class="intro-logo-icon">🤱</div>
                        <div class="intro-brand">맘곁 MOMGYEOT</div>
                    </div>
                    
                    <div class="intro-headline">
                        <h1>
                            <span class="typing-line line1">아기를 품은 엄마,</span>
                            <span class="typing-line line2">그 곁을 지키는 아빠,</span>
                            <span class="typing-line line3">그 둘을 받쳐주는 <span class="highlight">맘곁</span>.</span>
                        </h1>
                    </div>
                    
                    <p class="intro-subtitle">
                        <span class="heart-text">아이만이 아니라, 부모의 마음까지</span><br>
                        <span class="heart-text">함께 돌보는 동반자가 되고 싶어요. 💕</span>
                    </p>
                    
                    <div class="intro-cta">
                        <button class="intro-btn" onclick="showLogin()">
                            시작하기 <span>→</span>
                        </button>
                    </div>
                    
                    <div class="intro-footer">© 2026 맘곁 Momgyeot</div>
                </div>
            </div>
            
            <!-- 로그인 화면 -->
            <div class="page login-screen hidden" id="loginScreen">
                <div class="login-header">
                    <button class="back-btn" onclick="showIntro()">←</button>
                    
                    <div class="login-logo">
                        <div class="login-logo-icon">🤱</div>
                        <h2 class="login-title">맘곁에 오신 것을<br>환영해요</h2>
                        <p class="login-desc">간편하게 로그인하고 시작하세요</p>
                    </div>
                </div>
                
                <div class="login-buttons">
                    <button class="login-btn login-btn-kakao" onclick="loginWith('kakao')">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 3C6.5 3 2 6.58 2 11c0 2.84 1.86 5.33 4.64 6.77l-.96 3.56c-.08.3.23.55.5.4l4.13-2.73c.56.06 1.12.1 1.69.1 5.5 0 10-3.58 10-8S17.5 3 12 3z"/>
                        </svg>
                        카카오로 시작하기
                    </button>
                    
                    <button class="login-btn login-btn-google" onclick="loginWith('google')">
                        <svg class="btn-icon" viewBox="0 0 24 24">
                            <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                            <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                            <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                            <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                        </svg>
                        Google로 계속하기
                    </button>
                    
                    <button class="login-btn login-btn-apple" onclick="loginWith('apple')">
                        <svg class="btn-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                        </svg>
                        Apple로 계속하기
                    </button>
                    
                    <div class="divider">
                        <div class="divider-line"></div>
                        <span class="divider-text">또는</span>
                        <div class="divider-line"></div>
                    </div>
                    
                    <button class="login-btn login-btn-guest" onclick="guestLogin()">
                        로그인 없이 둘러보기
                    </button>
                </div>
            </div>
            
            <!-- 홈 화면 -->
            <div class="page home-screen hidden" id="homeScreen">
                <div class="home-header">
                    <button class="menu-btn" type="button" id="homeMenuBtn">☰</button>
                    <div class="home-greeting">
                        <span class="greeting-emoji">👋</span>
                        <div>
                            <p class="greeting-text">안녕하세요!</p>
                            <p class="greeting-name" id="userName">게스트님</p>
                        </div>
                    </div>
                    <div class="home-icons">
                        <button class="icon-btn" type="button" id="homeNotiBtn">🔔</button>
                    </div>
                </div>
                
                <div class="home-content">
                    <h2 class="section-title">맘곁 선택하기</h2>
                    <p class="section-desc">나에게 맞는 맘곁을 선택해주세요</p>
                    
                    <div class="mate-cards">
                        <button class="mate-card" type="button" id="cardSaessak">
                            <span class="mate-tag">임신준비</span>
                            <div class="mate-icon">🌱</div>
                            <h3>예비맘곁</h3>
                            <p>임신을 준비하는<br>예비 엄마를 위해</p>
                        </button>
                        
                        <button class="mate-card" type="button" id="cardYebi">
                            <span class="mate-tag">임신중</span>
                            <div class="mate-icon">🤰</div>
                            <h3>임신맘곁</h3>
                            <p>소중한 생명과 함께하는<br>임신 기간 동안</p>
                        </button>
                        
                        <button class="mate-card" type="button" id="cardAgi">
                            <span class="mate-tag">출산후</span>
                            <div class="mate-icon">👶</div>
                            <h3>초보맘곁</h3>
                            <p>아기와 함께하는<br>육아의 모든 순간</p>
                        </button>
                        
                        <button class="mate-card" type="button" id="cardExpert">
                            <span class="mate-tag">전문상담</span>
                            <div class="mate-icon">👩‍⚕️</div>
                            <h3>전문가 연결</h3>
                            <p>전문 상담이<br>필요할 때</p>
                        </button>
                    </div>
                </div>
                
                <!-- 하단 네비게이션 -->
                <div class="bottom-nav">
                    <button class="nav-item active" type="button" id="navHome">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                        </svg>
                        <span>홈</span>
                    </button>
                    <button class="nav-item" type="button" id="navCalendar">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/>
                        </svg>
                        <span>캘린더</span>
                    </button>
                    <button class="nav-item" type="button" id="navChat">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                        </svg>
                        <span>채팅</span>
                    </button>
                    <button class="nav-item" type="button" id="navMy">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                        </svg>
                        <span>마이</span>
                    </button>
                </div>
            </div>
            
            <!-- 온보딩 화면 -->
            <div class="page onboarding-screen hidden" id="onboardingScreen">
                <div class="onboarding-header">
                    <button class="back-btn" type="button" id="onboardingBackBtn">←</button>
                    <div class="onboarding-progress">
                        <span id="onboardingStep">1</span> / <span id="onboardingTotal">3</span>
                    </div>
                    <div style="width: 40px;"></div>
                </div>
                
                <div class="onboarding-content" id="onboardingContent">
                    <!-- 동적으로 생성됨 -->
                </div>
            </div>
            
            <!-- 채팅 화면 -->
            <div class="page chat-screen hidden" id="chatScreen">
                <div class="chat-header">
                    <button class="back-btn" type="button" id="chatBackBtn">←</button>
                    <div class="chat-title">
                        <span id="chatMateIcon">🌱</span>
                        <span id="chatMateName">예비맘곁</span>
                    </div>
                    <div style="width: 40px;"></div>
                </div>
                
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot">
                        <div class="message-avatar">🤱</div>
                        <div class="message-content">
                            <p>안녕하세요! 맘곁이에요 😊</p>
                            <p>무엇이든 편하게 물어보세요.</p>
                        </div>
                    </div>
                </div>
                
                <div class="chat-input-area">
                    <div class="recording-indicator" id="recordingIndicator">
                        <span class="recording-dot"></span>
                        듣고 있어요...
                    </div>
                    <input type="text" class="chat-input" placeholder="메시지를 입력하세요..." id="chatInput">
                    <button class="mic-btn" type="button" id="micBtn" aria-label="음성 입력">
                        <div class="sound-wave">
                            <span class="bar"></span>
                            <span class="bar"></span>
                            <span class="bar"></span>
                        </div>
                    </button>
                    <button class="send-btn" type="button" id="sendBtn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- 캘린더 화면 -->
            <div class="page calendar-screen hidden" id="calendarScreen">
                <div class="screen-header">
                    <button class="menu-btn" type="button" id="calMenuBtn">☰</button>
                    <h1 class="screen-title">캘린더</h1>
                    <button class="icon-btn" type="button" id="calNotiBtn">🔔</button>
                </div>
                
                <div class="calendar-content">
                    <div class="calendar-nav">
                        <button type="button" id="prevMonth">‹</button>
                        <span class="calendar-month" id="currentMonth">2026년 1월</span>
                        <button type="button" id="nextMonth">›</button>
                    </div>
                    
                    <div class="calendar-weekdays">
                        <span>일</span><span>월</span><span>화</span><span>수</span><span>목</span><span>금</span><span>토</span>
                    </div>
                    
                    <div class="calendar-days" id="calendarDays">
                        <!-- 자바스크립트로 생성 -->
                    </div>
                    
                    <div class="calendar-events">
                        <h3>오늘의 일정</h3>
                        <div class="event-item">
                            <div class="event-dot" style="background: #E8B4B8;"></div>
                            <div class="event-info">
                                <p class="event-title">산부인과 정기 검진</p>
                                <p class="event-time">오후 2:00</p>
                            </div>
                        </div>
                        <div class="event-item">
                            <div class="event-dot" style="background: #5E6B3A;"></div>
                            <div class="event-info">
                                <p class="event-title">임산부 요가 수업</p>
                                <p class="event-time">오후 4:30</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bottom-nav">
                    <button class="nav-item" type="button" id="calNavHome"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>홈</span></button>
                    <button class="nav-item active" type="button" id="calNavCalendar"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg><span>캘린더</span></button>
                    <button class="nav-item" type="button" id="calNavChat"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg><span>채팅</span></button>
                    <button class="nav-item" type="button" id="calNavMy"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>마이</span></button>
                </div>
            </div>
            
            <!-- 마이페이지 화면 -->
            <div class="page my-screen hidden" id="myScreen">
                <div class="screen-header">
                    <button class="menu-btn" type="button" id="myMenuBtn">☰</button>
                    <h1 class="screen-title">마이페이지</h1>
                    <button class="icon-btn" type="button" id="myNotiBtn">🔔</button>
                </div>
                
                <div class="my-content">
                    <div class="profile-section">
                        <div class="profile-avatar">👩</div>
                        <div class="profile-info">
                            <h2 id="profileName">게스트님</h2>
                            <p>맘곁과 함께한 지 <strong>1일</strong></p>
                        </div>
                        <button class="edit-btn" type="button">편집</button>
                    </div>
                    
                    <div class="my-stats">
                        <div class="stat-item">
                            <span class="stat-num">3</span>
                            <span class="stat-label">대화 수</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-num">1</span>
                            <span class="stat-label">저장됨</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-num">0</span>
                            <span class="stat-label">일정</span>
                        </div>
                    </div>
                    
                    <div class="my-menu-list">
                        <button class="my-menu-item" type="button">
                            <span class="menu-icon">📋</span>
                            <span>내 정보 관리</span>
                            <span class="menu-arrow">›</span>
                        </button>
                        <button class="my-menu-item" type="button">
                            <span class="menu-icon">💬</span>
                            <span>대화 기록</span>
                            <span class="menu-arrow">›</span>
                        </button>
                        <button class="my-menu-item" type="button">
                            <span class="menu-icon">⭐</span>
                            <span>저장한 답변</span>
                            <span class="menu-arrow">›</span>
                        </button>
                        <button class="my-menu-item" type="button" id="goToSettingsBtn">
                            <span class="menu-icon">⚙️</span>
                            <span>설정</span>
                            <span class="menu-arrow">›</span>
                        </button>
                        <button class="my-menu-item" type="button" id="goToTermsBtn">
                            <span class="menu-icon">📄</span>
                            <span>이용약관</span>
                            <span class="menu-arrow">›</span>
                        </button>
                        <button class="my-menu-item" type="button" id="goToPrivacyBtn">
                            <span class="menu-icon">🔒</span>
                            <span>개인정보처리방침</span>
                            <span class="menu-arrow">›</span>
                        </button>
                        <button class="my-menu-item" type="button">
                            <span class="menu-icon">❓</span>
                            <span>도움말</span>
                            <span class="menu-arrow">›</span>
                        </button>
                    </div>
                </div>
                
                <div class="bottom-nav">
                    <button class="nav-item" type="button" id="myNavHome"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg><span>홈</span></button>
                    <button class="nav-item" type="button" id="myNavCalendar"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11z"/></svg><span>캘린더</span></button>
                    <button class="nav-item" type="button" id="myNavChat"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg><span>채팅</span></button>
                    <button class="nav-item active" type="button" id="myNavMy"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg><span>마이</span></button>
                </div>
            </div>
            
            <!-- 설정 화면 -->
            <div class="page settings-screen hidden" id="settingsScreen">
                <div class="screen-header">
                    <button class="back-btn" type="button" id="settingsBackBtn">←</button>
                    <h1 class="screen-title">설정</h1>
                    <div style="width: 40px;"></div>
                </div>
                
                <div class="settings-content">
                    <div class="settings-section">
                        <h3 class="settings-section-title">화면 설정</h3>
                        <div class="settings-item">
                            <div class="settings-item-info">
                                <span class="settings-icon">🌙</span>
                                <div>
                                    <p class="settings-item-title">다크 모드</p>
                                    <p class="settings-item-desc">어두운 화면으로 전환합니다</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3 class="settings-section-title">알림 설정</h3>
                        <div class="settings-item">
                            <div class="settings-item-info">
                                <span class="settings-icon">🔔</span>
                                <div>
                                    <p class="settings-item-title">푸시 알림</p>
                                    <p class="settings-item-desc">상담 답변, 일정 알림을 받습니다</p>
                                </div>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pushNotiToggle" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3 class="settings-section-title">앱 정보</h3>
                        <div class="settings-item" style="cursor: default;">
                            <div class="settings-item-info">
                                <span class="settings-icon">📱</span>
                                <div>
                                    <p class="settings-item-title">버전</p>
                                    <p class="settings-item-desc">1.0.0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 약관 화면 (이용약관 / 개인정보처리방침 공용) -->
            <div class="page policy-screen hidden" id="policyScreen">
                <div class="screen-header">
                    <button class="back-btn" type="button" id="policyBackBtn">←</button>
                    <h1 class="screen-title" id="policyTitle">이용약관</h1>
                    <div style="width: 40px;"></div>
                </div>
                
                <div class="policy-content" id="policyContent">
                    <div class="policy-loading">불러오는 중...</div>
                </div>
            </div>
            
            <!-- 알림 화면 -->
            <div class="page notification-screen hidden" id="notificationScreen">
                <div class="screen-header">
                    <button class="back-btn" type="button" id="notiBackBtn">←</button>
                    <h1 class="screen-title">알림</h1>
                    <div style="width: 40px;"></div>
                </div>
                
                <div class="noti-content">
                    <div class="noti-item unread" id="notiChat" style="cursor: pointer;">
                        <div class="noti-icon">💬</div>
                        <div class="noti-info">
                            <p class="noti-title">맘곁에서 답변이 도착했어요</p>
                            <p class="noti-desc">임신 준비에 대한 답변을 확인해보세요.</p>
                            <p class="noti-time">방금 전</p>
                        </div>
                    </div>
                    <div class="noti-item unread" id="notiCalendar" style="cursor: pointer;">
                        <div class="noti-icon">📅</div>
                        <div class="noti-info">
                            <p class="noti-title">내일 일정이 있어요</p>
                            <p class="noti-desc">산부인과 정기 검진 - 오후 2:00</p>
                            <p class="noti-time">1시간 전</p>
                        </div>
                    </div>
                    <div class="noti-item" id="notiWelcome" style="cursor: pointer;">
                        <div class="noti-icon">🎉</div>
                        <div class="noti-info">
                            <p class="noti-title">맘곁에 오신 것을 환영해요!</p>
                            <p class="noti-desc">맘곁과 함께 건강한 임신 여정을 시작하세요.</p>
                            <p class="noti-time">오늘</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 전문가 연결 화면 -->
            <div class="page expert-screen hidden" id="expertScreen">
                <div class="expert-header">
                    <button class="back-btn" type="button" id="expertBackBtn">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <h1>전문가 연결</h1>
                    <div style="width: 24px;"></div>
                </div>
                
                <div class="expert-content">
                    <div class="expert-intro">
                        <div class="expert-icon">👩‍⚕️</div>
                        <h2>전문 상담이 필요하신가요?</h2>
                        <p>모유수유, 육아 전문가와<br>1:1 상담을 받아보세요</p>
                    </div>
                    
                    <div class="expert-options">
                        <a href="http://pf.kakao.com/_xkxjxaAn/chat" target="_blank" class="expert-card kakao">
                            <div class="expert-card-icon">💬</div>
                            <div class="expert-card-content">
                                <h3>카카오톡 상담</h3>
                                <p>실시간 채팅 상담</p>
                                <span class="expert-card-tag">바로 연결</span>
                            </div>
                            <div class="expert-card-arrow">→</div>
                        </a>
                        
                        <button class="expert-card reservation" type="button" id="reservationBtn">
                            <div class="expert-card-icon">📅</div>
                            <div class="expert-card-content">
                                <h3>상담 예약</h3>
                                <p>원하는 시간에 상담 예약</p>
                                <span class="expert-card-tag">예약 가능</span>
                            </div>
                            <div class="expert-card-arrow">→</div>
                        </button>
                    </div>
                    
                    <div class="expert-info">
                        <h4>상담 안내</h4>
                        <ul>
                            <li>모유수유 전문 상담 (IBCLC)</li>
                            <li>신생아 케어 상담</li>
                            <li>산후조리 상담</li>
                            <li>육아 고민 상담</li>
                        </ul>
                    </div>
                </div>
                
                <div class="bottom-nav">
                    <button class="nav-item" type="button" id="expertNavHome">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                        <span>홈</span>
                    </button>
                    <button class="nav-item" type="button" id="expertNavCalendar">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                        <span>캘린더</span>
                    </button>
                    <button class="nav-item" type="button" id="expertNavChat">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        <span>채팅</span>
                    </button>
                    <button class="nav-item" type="button" id="expertNavMy">
                        <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        <span>마이</span>
                    </button>
                </div>
            </div>
            
            <!-- 상담 예약 모달 -->
            <div class="reservation-modal hidden" id="reservationModal">
                <div class="reservation-overlay" id="reservationOverlay"></div>
                <div class="reservation-content">
                    <div class="reservation-header">
                        <h2>📅 상담 예약</h2>
                        <button class="close-modal-btn" type="button" id="closeReservationBtn">✕</button>
                    </div>
                    
                    <div class="reservation-body">
                        <div class="reservation-notice">
                            <span class="notice-icon">📞</span>
                            <p>평일 기준 <strong>24시간 이내</strong>에<br>전문 상담사가 연락드립니다</p>
                        </div>
                        
                        <form id="reservationForm">
                            <div class="form-group">
                                <label for="resPhone">연락처 <span class="required">*</span></label>
                                <input type="tel" id="resPhone" placeholder="010-0000-0000" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="resNickname">닉네임 <span class="required">*</span></label>
                                <input type="text" id="resNickname" placeholder="닉네임을 입력해주세요" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="resBabyName">아기 이름 (태명)</label>
                                <input type="text" id="resBabyName" placeholder="아기 이름 또는 태명">
                            </div>
                            
                            <div class="form-group">
                                <label for="resCategory">상담 분야</label>
                                <select id="resCategory">
                                    <option value="모유수유">모유수유 상담</option>
                                    <option value="신생아케어">신생아 케어</option>
                                    <option value="산후조리">산후조리 상담</option>
                                    <option value="육아고민">육아 고민 상담</option>
                                    <option value="기타">기타</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="resMemo">상담 내용 (선택)</label>
                                <textarea id="resMemo" placeholder="상담받고 싶은 내용을 간단히 적어주세요" rows="3"></textarea>
                            </div>
                            
                            <button type="submit" class="reservation-submit-btn" id="submitReservation">
                                예약 신청하기
                            </button>
                        </form>
                        
                        <p class="reservation-footer">
                            ※ 개인정보는 상담 목적으로만 사용됩니다
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- 사이드 메뉴 -->
            <div class="side-menu hidden" id="sideMenu">
                <div class="side-menu-overlay" id="sideMenuOverlay"></div>
                <div class="side-menu-content">
                    <div class="side-menu-header">
                        <div class="side-profile">
                            <div class="side-avatar">👩</div>
                            <div>
                                <p class="side-name" id="sideName">게스트님</p>
                                <p class="side-email">맘곁과 함께해요 💕</p>
                            </div>
                        </div>
                        <button class="close-menu-btn" type="button" id="closeMenuBtn">✕</button>
                    </div>
                    
                    <div class="side-menu-list">
                        <button class="side-menu-item" type="button" id="sideHome">
                            <span class="side-icon">🏠</span>
                            <span>홈</span>
                        </button>
                        
                        <div class="side-divider"></div>
                        
                        <a href="https://www.momgyeot.com" target="_blank" class="side-menu-item">
                            <span class="side-icon">🌸</span>
                            <span>맘곁 태교</span>
                        </a>
                        <a href="https://mktaegyo.replit.app" target="_blank" class="side-menu-item">
                            <span class="side-icon">📖</span>
                            <span>새로쓰는 태교신기</span>
                        </a>
                        <a href="https://mothersbaby-ai.vercel.app/" target="_blank" class="side-menu-item">
                            <span class="side-icon">👶</span>
                            <span>맘곁 육아 컴패니언</span>
                        </a>
                        <a href="https://breastfeedingrealguide-10.replit.app" target="_blank" class="side-menu-item">
                            <span class="side-icon">🤱</span>
                            <span>모유수유 리얼 가이드</span>
                        </a>
                        <a href="https://www.mothersbaby.co.kr" target="_blank" class="side-menu-item">
                            <span class="side-icon">🛒</span>
                            <span>쇼핑몰</span>
                        </a>
                        
                        <div class="side-divider"></div>
                        
                        <button class="side-menu-item" type="button" id="sideCalendar">
                            <span class="side-icon">📅</span>
                            <span>캘린더</span>
                        </button>
                        <button class="side-menu-item" type="button" id="sideHistory">
                            <span class="side-icon">💬</span>
                            <span>대화 기록</span>
                        </button>
                        <button class="side-menu-item" type="button" id="sideSaved">
                            <span class="side-icon">⭐</span>
                            <span>저장한 답변</span>
                        </button>
                        
                        <div class="side-divider"></div>
                        
                        <button class="side-menu-item" type="button" id="sideSettings">
                            <span class="side-icon">⚙️</span>
                            <span>설정</span>
                        </button>
                        <button class="side-menu-item" type="button" id="sideLogout">
                            <span class="side-icon">🚪</span>
                            <span>로그아웃</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="home-indicator"></div>
        </div>
    </div>
    
    <script>
        // 화면 전환 함수들
        function hideAll() {
            document.getElementById('introScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('homeScreen').classList.add('hidden');
            document.getElementById('onboardingScreen').classList.add('hidden');
            document.getElementById('chatScreen').classList.add('hidden');
            document.getElementById('calendarScreen').classList.add('hidden');
            document.getElementById('myScreen').classList.add('hidden');
            document.getElementById('notificationScreen').classList.add('hidden');
            document.getElementById('settingsScreen').classList.add('hidden');
            document.getElementById('policyScreen').classList.add('hidden');
            document.getElementById('expertScreen').classList.add('hidden');
            closeSideMenu();
        }
        
        function showPage(pageId) {
            hideAll();
            var page = document.getElementById(pageId);
            if (page) {
                page.classList.remove('hidden');
            }
        }
        
        // 온보딩 데이터
        var onboardingData = {
            saessak: {
                name: '예비맘곁',
                icon: '🌱',
                questions: [
                    {
                        question: '임신 준비를 시작한 지\n얼마나 되셨나요?',
                        subtitle: '맞춤 정보를 드리기 위해 여쭤봐요',
                        options: [
                            { icon: '🌟', title: '이제 막 시작했어요', sub: '1개월 이내' },
                            { icon: '📅', title: '몇 개월 됐어요', sub: '1~6개월' },
                            { icon: '⏰', title: '꽤 시간이 지났어요', sub: '6개월 이상' },
                            { icon: '🤫', title: '말하기 어려워요', sub: '' }
                        ]
                    },
                    {
                        question: '지금 가장 궁금하거나\n힘든 부분이 있나요?',
                        subtitle: '',
                        options: [
                            { icon: '📚', title: '임신 준비 정보가 궁금해요', sub: '건강, 영양, 검사 등' },
                            { icon: '💝', title: '마음이 힘들어요', sub: '정서적 지지가 필요해요' },
                            { icon: '💑', title: '부부 관계가 걱정돼요', sub: '대화, 소통' },
                            { icon: '🏥', title: '병원/시술 정보가 궁금해요', sub: '' }
                        ]
                    },
                    {
                        question: '맘곁이 어떻게\n불러드릴까요?',
                        subtitle: '편하게 불러드릴 이름을 알려주세요',
                        type: 'input',
                        placeholder: '예: 하늘, 보미, 엄마'
                    }
                ]
            },
            yebi: {
                name: '임신맘곁',
                icon: '🤰',
                questions: [
                    {
                        question: '지금 임신 몇 주차이세요?',
                        subtitle: '맞춤 정보를 드리기 위해 여쭤봐요',
                        options: [
                            { icon: '🌱', title: '초기예요', sub: '1~12주' },
                            { icon: '🌿', title: '중기예요', sub: '13~27주' },
                            { icon: '🌳', title: '후기예요', sub: '28주 이상' },
                            { icon: '❓', title: '잘 모르겠어요', sub: '' }
                        ]
                    },
                    {
                        question: '첫 아이인가요?',
                        subtitle: '',
                        options: [
                            { icon: '👶', title: '네, 첫 아이예요', sub: '' },
                            { icon: '👨‍👩‍👧', title: '아니요, 둘째 이상이에요', sub: '' }
                        ]
                    },
                    {
                        question: '맘곁이 어떻게\n불러드릴까요?',
                        subtitle: '태명이나 닉네임을 알려주세요',
                        type: 'input',
                        placeholder: '예: 콩이맘, 하늘, 보미'
                    }
                ]
            },
            agi: {
                name: '초보맘곁',
                icon: '👶',
                questions: [
                    {
                        question: '아기가 태어난 지\n얼마나 됐나요?',
                        subtitle: '맞춤 정보를 드리기 위해 여쭤봐요',
                        options: [
                            { icon: '🍼', title: '신생아예요', sub: '0~3개월' },
                            { icon: '👶', title: '아직 어려요', sub: '4~6개월' },
                            { icon: '🧒', title: '조금 컸어요', sub: '7~12개월' },
                            { icon: '🚶', title: '돌이 지났어요', sub: '12개월 이상' }
                        ]
                    },
                    {
                        question: '지금 가장 힘든 부분이\n있으신가요?',
                        subtitle: '',
                        options: [
                            { icon: '🤱', title: '수유가 힘들어요', sub: '모유수유, 분유, 젖병' },
                            { icon: '😴', title: '수면이 부족해요', sub: '밤수유, 잠투정' },
                            { icon: '📈', title: '발달이 걱정돼요', sub: '성장, 발달 체크' },
                            { icon: '💪', title: '체력이 힘들어요', sub: '산후조리, 회복' }
                        ]
                    },
                    {
                        question: '맘곁이 어떻게\n불러드릴까요?',
                        subtitle: '편하게 불러드릴 이름을 알려주세요',
                        type: 'input',
                        placeholder: '예: 콩이맘, 하늘맘'
                    }
                ]
            }
        };
        
        var currentOnboarding = {
            type: null,
            step: 0,
            answers: []
        };
        
        function startOnboarding(type) {
            currentOnboarding.type = type;
            currentOnboarding.step = 0;
            currentOnboarding.answers = [];
            
            hideAll();
            document.getElementById('onboardingScreen').classList.remove('hidden');
            
            var data = onboardingData[type];
            document.getElementById('onboardingTotal').textContent = data.questions.length;
            
            renderOnboardingStep();
        }
        
        function renderOnboardingStep() {
            var data = onboardingData[currentOnboarding.type];
            var question = data.questions[currentOnboarding.step];
            var container = document.getElementById('onboardingContent');
            
            document.getElementById('onboardingStep').textContent = currentOnboarding.step + 1;
            
            var html = '<div class="onboarding-question">';
            html += '<h2>' + question.question.replace(/\n/g, '<br>') + '</h2>';
            if (question.subtitle) {
                html += '<p>' + question.subtitle + '</p>';
            }
            html += '</div>';
            
            if (question.type === 'input') {
                html += '<div class="onboarding-input-row">';
                html += '<input type="text" class="onboarding-input" placeholder="' + question.placeholder + '" id="onboardingInput">';
                html += '<button class="onboarding-next-btn" id="onboardingNextBtn" disabled>완료</button>';
                html += '</div>';
            } else {
                html += '<div class="onboarding-options">';
                question.options.forEach(function(opt, idx) {
                    html += '<button class="onboarding-option" type="button" data-idx="' + idx + '">';
                    html += '<span class="option-icon">' + opt.icon + '</span>';
                    html += '<div class="option-text">';
                    html += '<strong>' + opt.title + '</strong>';
                    if (opt.sub) {
                        html += '<span>' + opt.sub + '</span>';
                    }
                    html += '</div>';
                    html += '</button>';
                });
                html += '</div>';
            }
            
            container.innerHTML = html;
            
            // 이벤트 바인딩
            if (question.type === 'input') {
                var input = document.getElementById('onboardingInput');
                var btn = document.getElementById('onboardingNextBtn');
                
                input.addEventListener('input', function() {
                    btn.disabled = input.value.trim() === '';
                });
                
                btn.addEventListener('click', function() {
                    currentOnboarding.answers.push(input.value.trim());
                    finishOnboarding();
                });
                
                input.focus();
            } else {
                var options = container.querySelectorAll('.onboarding-option');
                options.forEach(function(opt) {
                    opt.addEventListener('click', function() {
                        var idx = parseInt(opt.getAttribute('data-idx'));
                        currentOnboarding.answers.push(question.options[idx].title);
                        
                        opt.classList.add('selected');
                        
                        setTimeout(function() {
                            if (currentOnboarding.step < onboardingData[currentOnboarding.type].questions.length - 1) {
                                currentOnboarding.step++;
                                renderOnboardingStep();
                            } else {
                                finishOnboarding();
                            }
                        }, 300);
                    });
                });
            }
        }
        
        function finishOnboarding() {
            var data = onboardingData[currentOnboarding.type];
            var nickname = currentOnboarding.answers[currentOnboarding.answers.length - 1] || '맘';
            
            // 채팅 화면으로 이동
            showChatWithContext(currentOnboarding.type, data.icon, data.name, nickname, currentOnboarding.answers);
        }
        
        function showChatWithContext(type, icon, name, nickname, answers) {
            hideAll();
            document.getElementById('chatMateIcon').textContent = icon;
            document.getElementById('chatMateName').textContent = name;
            document.getElementById('chatScreen').classList.remove('hidden');
            
            // 맞춤 환영 메시지 생성
            var welcomeMsg = '';
            if (type === 'saessak') {
                welcomeMsg = '<p>안녕하세요, ' + nickname + '님! 🌱</p>';
                welcomeMsg += '<p>임신 준비 중이시군요. 함께 걸어갈게요.</p>';
                welcomeMsg += '<p>궁금하거나 힘든 게 있으면 언제든 말씀해 주세요 💚</p>';
            } else if (type === 'yebi') {
                welcomeMsg = '<p>안녕하세요, ' + nickname + '님! 🤰</p>';
                welcomeMsg += '<p>소중한 생명과 함께하는 시간이네요.</p>';
                welcomeMsg += '<p>임신 기간 동안 옆에서 함께할게요 💕</p>';
            } else if (type === 'agi') {
                welcomeMsg = '<p>안녕하세요, ' + nickname + '님! 👶</p>';
                welcomeMsg += '<p>육아, 정말 대단하세요!</p>';
                welcomeMsg += '<p>힘들 땐 언제든 기대세요 💪</p>';
            }
            
            var messagesDiv = document.querySelector('.chat-messages');
            messagesDiv.innerHTML = '<div class="message bot"><div class="message-avatar">' + icon + '</div><div class="message-content">' + welcomeMsg + '</div></div>';
        }
        
        function selectMate(type) {
            if (type === 'expert') {
                showExpert();
                return;
            }
            startOnboarding(type);
        }
        
        function showExpert() {
            hideAll();
            document.getElementById('expertScreen').classList.remove('hidden');
        }
        
        function showIntro() {
            hideAll();
            document.getElementById('introScreen').classList.remove('hidden');
        }
        
        function showLogin() {
            hideAll();
            document.getElementById('loginScreen').classList.remove('hidden');
        }
        
        function showHome() {
            hideAll();
            document.getElementById('homeScreen').classList.remove('hidden');
        }
        
        function showChat(type, icon, name) {
            hideAll();
            document.getElementById('chatMateIcon').textContent = icon;
            document.getElementById('chatMateName').textContent = name;
            document.getElementById('chatScreen').classList.remove('hidden');
            
            // 환영 메시지 업데이트
            var welcomeMsg = document.querySelector('.chat-messages');
            welcomeMsg.innerHTML = `
                <div class="message bot">
                    <div class="message-avatar">${icon}</div>
                    <div class="message-content">
                        <p>안녕하세요! ${name}이에요 😊</p>
                        <p>무엇이든 편하게 물어보세요.</p>
                    </div>
                </div>
            `;
        }
        
        function showCalendar() {
            hideAll();
            document.getElementById('calendarScreen').classList.remove('hidden');
            generateCalendar();
        }
        
        function showMyPage() {
            hideAll();
            document.getElementById('myScreen').classList.remove('hidden');
        }
        
        function showNotification() {
            hideAll();
            document.getElementById('notificationScreen').classList.remove('hidden');
        }
        
        // 사이드 메뉴
        function openSideMenu() {
            document.getElementById('sideMenu').classList.remove('hidden');
        }
        
        function closeSideMenu() {
            document.getElementById('sideMenu').classList.add('hidden');
        }
        
        function guestLogin() {
            document.getElementById('userName').textContent = '게스트님';
            document.getElementById('profileName').textContent = '게스트님';
            document.getElementById('sideName').textContent = '게스트님';
            showHome();
        }
        
        function loginWith(provider) {
            alert(provider + ' 로그인은 준비 중이에요!');
        }
        
        // 캘린더 변수
        var calendarYear = new Date().getFullYear();
        var calendarMonth = new Date().getMonth();
        var calendarEvents = [
            { date: '2026-01-30', title: '산부인과 정기 검진', time: '오후 2:00', color: '#E8B4B8' },
            { date: '2026-01-30', title: '임산부 요가 수업', time: '오후 4:30', color: '#5E6B3A' },
            { date: '2026-01-15', title: '태교 음악회', time: '오후 3:00', color: '#5E6B3A' }
        ];
        
        // 캘린더 생성
        function generateCalendar() {
            var container = document.getElementById('calendarDays');
            var today = new Date();
            
            var firstDay = new Date(calendarYear, calendarMonth, 1).getDay();
            var lastDate = new Date(calendarYear, calendarMonth + 1, 0).getDate();
            
            // 월 표시 업데이트
            document.getElementById('currentMonth').textContent = calendarYear + '년 ' + (calendarMonth + 1) + '월';
            
            var html = '';
            
            // 빈 칸
            for (var i = 0; i < firstDay; i++) {
                html += '<div class="calendar-day"></div>';
            }
            
            // 날짜
            for (var d = 1; d <= lastDate; d++) {
                var isToday = (d === today.getDate() && calendarMonth === today.getMonth() && calendarYear === today.getFullYear()) ? 'today' : '';
                
                // 일정 확인
                var dateStr = calendarYear + '-' + String(calendarMonth + 1).padStart(2, '0') + '-' + String(d).padStart(2, '0');
                var hasEvent = calendarEvents.some(e => e.date === dateStr) ? 'has-event' : '';
                
                html += '<div class="calendar-day ' + isToday + ' ' + hasEvent + '" onclick="selectDate(' + d + ')">' + d + '</div>';
            }
            
            container.innerHTML = html;
            
            // 오늘 일정 표시
            updateTodayEvents();
        }
        
        // 이전 달
        function prevCalendarMonth() {
            calendarMonth--;
            if (calendarMonth < 0) {
                calendarMonth = 11;
                calendarYear--;
            }
            generateCalendar();
        }
        
        // 다음 달
        function nextCalendarMonth() {
            calendarMonth++;
            if (calendarMonth > 11) {
                calendarMonth = 0;
                calendarYear++;
            }
            generateCalendar();
        }
        
        // 날짜 선택
        function selectDate(day) {
            var dateStr = calendarYear + '-' + String(calendarMonth + 1).padStart(2, '0') + '-' + String(day).padStart(2, '0');
            var dayEvents = calendarEvents.filter(e => e.date === dateStr);
            
            var eventsHtml = '<h3>' + (calendarMonth + 1) + '월 ' + day + '일 일정</h3>';
            
            if (dayEvents.length > 0) {
                dayEvents.forEach(function(event) {
                    eventsHtml += `
                        <div class="event-item">
                            <div class="event-dot" style="background: ${event.color};"></div>
                            <div class="event-info">
                                <p class="event-title">${event.title}</p>
                                <p class="event-time">${event.time}</p>
                            </div>
                        </div>
                    `;
                });
            } else {
                eventsHtml += '<p style="color: #8A8A8A; padding: 20px 0; text-align: center;">일정이 없어요</p>';
            }
            
            eventsHtml += '<button onclick="showAddEventModal(\'' + dateStr + '\')" style="width: 100%; padding: 12px; margin-top: 12px; background: #5E6B3A; color: white; border: none; border-radius: 12px; font-size: 14px; cursor: pointer;">+ 일정 추가</button>';
            
            document.querySelector('.calendar-events').innerHTML = eventsHtml;
        }
        
        // 오늘 일정 표시
        function updateTodayEvents() {
            var today = new Date();
            var todayStr = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
            var todayEvents = calendarEvents.filter(e => e.date === todayStr);
            
            var eventsHtml = '<h3>오늘의 일정</h3>';
            
            if (todayEvents.length > 0) {
                todayEvents.forEach(function(event) {
                    eventsHtml += `
                        <div class="event-item">
                            <div class="event-dot" style="background: ${event.color};"></div>
                            <div class="event-info">
                                <p class="event-title">${event.title}</p>
                                <p class="event-time">${event.time}</p>
                            </div>
                        </div>
                    `;
                });
            } else {
                eventsHtml += '<p style="color: #8A8A8A; padding: 20px 0; text-align: center;">오늘은 일정이 없어요 ✨</p>';
            }
            
            document.querySelector('.calendar-events').innerHTML = eventsHtml;
        }
        
        // 일정 추가 모달
        function showAddEventModal(dateStr) {
            var modal = document.createElement('div');
            modal.id = 'addEventModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            
            var isDark = document.body.classList.contains('dark-mode');
            var bgColor = isDark ? '#252525' : 'white';
            var textColor = isDark ? '#F0F0F0' : '#3D4A2D';
            var inputBg = isDark ? '#333' : '#F5F5F5';
            
            modal.innerHTML = `
                <div style="background: ${bgColor}; border-radius: 20px; padding: 24px; width: 90%; max-width: 340px;">
                    <h3 style="color: ${textColor}; margin-bottom: 16px;">새 일정 추가</h3>
                    <p style="color: #8A8A8A; font-size: 14px; margin-bottom: 16px;">${dateStr}</p>
                    <input type="text" id="eventTitle" placeholder="일정 제목" style="width: 100%; padding: 12px; border: none; background: ${inputBg}; border-radius: 12px; margin-bottom: 12px; color: ${textColor};">
                    <input type="time" id="eventTime" style="width: 100%; padding: 12px; border: none; background: ${inputBg}; border-radius: 12px; margin-bottom: 16px; color: ${textColor};">
                    <div style="display: flex; gap: 12px;">
                        <button onclick="closeAddEventModal()" style="flex: 1; padding: 12px; background: ${inputBg}; color: ${textColor}; border: none; border-radius: 12px; cursor: pointer;">취소</button>
                        <button onclick="addNewEvent('${dateStr}')" style="flex: 1; padding: 12px; background: #5E6B3A; color: white; border: none; border-radius: 12px; cursor: pointer;">추가</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function closeAddEventModal() {
            var modal = document.getElementById('addEventModal');
            if (modal) modal.remove();
        }
        
        function addNewEvent(dateStr) {
            var title = document.getElementById('eventTitle').value.trim();
            var time = document.getElementById('eventTime').value;
            
            if (!title) {
                alert('일정 제목을 입력해주세요.');
                return;
            }
            
            var formattedTime = time ? formatTime(time) : '종일';
            
            calendarEvents.push({
                date: dateStr,
                title: title,
                time: formattedTime,
                color: '#5E6B3A'
            });
            
            closeAddEventModal();
            generateCalendar();
            
            // 마이페이지 일정 수 업데이트
            updateEventCount();
            
            alert('일정이 추가되었어요! 📅');
        }
        
        function formatTime(time24) {
            var parts = time24.split(':');
            var hours = parseInt(parts[0]);
            var minutes = parts[1];
            var period = hours >= 12 ? '오후' : '오전';
            hours = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
            return period + ' ' + hours + ':' + minutes;
        }
        
        function updateEventCount() {
            var countEl = document.querySelector('.stat-item:last-child .stat-num');
            if (countEl) {
                countEl.textContent = calendarEvents.length;
            }
        }
        
        // ==================== RAG API 설정 ====================
        // 맘곁 전용 API (Vercel 배포 후 활성화)
        const RAG_API_URL = '/api/search';
        
        // Supabase 직접 연결 (API 배포 전 테스트용)
        const SUPABASE_URL = 'https://oeyhdglnqalgowvrxbsm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9leWhkZ2xucWFsZ293dnJ4YnNtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0MTkyNzgsImV4cCI6MjA4NDk5NTI3OH0.RRuEiT7EgLvvAUMB88lqNcN7bbUMupxSQd3EbmDIwt4';
        
        // API 모드 (true: Vercel API 사용, false: Supabase 직접 연결)
        const USE_API = true;
        
        // 메시지 전송
        async function sendMessage() {
            var input = document.getElementById('chatInput');
            var text = input.value.trim();
            if (!text) return;
            
            var messages = document.getElementById('chatMessages');
            var icon = document.getElementById('chatMateIcon').textContent;
            
            // 사용자 메시지 추가
            messages.innerHTML += `
                <div class="message user">
                    <div class="message-content">
                        <p>${escapeHtml(text)}</p>
                    </div>
                </div>
            `;
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
            
            // 로딩 표시
            var loadingId = 'loading-' + Date.now();
            messages.innerHTML += `
                <div class="message bot" id="${loadingId}">
                    <div class="message-avatar">${icon}</div>
                    <div class="message-content">
                        <p class="typing-indicator">답변을 준비하고 있어요<span class="dots">...</span></p>
                    </div>
                </div>
            `;
            messages.scrollTop = messages.scrollHeight;
            
            try {
                // RAG API 호출
                var response = await fetchRAGResponse(text);
                
                // 로딩 제거
                var loadingEl = document.getElementById(loadingId);
                if (loadingEl) loadingEl.remove();
                
                // AI 응답 표시
                if (response && response.content) {
                    messages.innerHTML += formatBotMessage(icon, response);
                } else {
                    messages.innerHTML += `
                        <div class="message bot">
                            <div class="message-avatar">${icon}</div>
                            <div class="message-content">
                                <p>죄송해요, 관련 정보를 찾지 못했어요. 😢</p>
                                <p>다른 방식으로 질문해 주시거나, 전문가 상담을 이용해 보세요!</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('RAG API Error:', error);
                var loadingEl = document.getElementById(loadingId);
                if (loadingEl) loadingEl.remove();
                
                messages.innerHTML += `
                    <div class="message bot">
                        <div class="message-avatar">${icon}</div>
                        <div class="message-content">
                            <p>네트워크 오류가 발생했어요. 잠시 후 다시 시도해 주세요. 🙏</p>
                        </div>
                    </div>
                `;
            }
            
            messages.scrollTop = messages.scrollHeight;
        }
        
        // RAG API 호출 함수
        async function fetchRAGResponse(query) {
            try {
                if (USE_API) {
                    // Vercel API 사용
                    var response = await fetch('/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            query: query,
                            mateType: currentOnboarding.type || 'default',
                            userInfo: {
                                nickname: currentOnboarding.answers?.[currentOnboarding.answers.length - 1],
                                answers: currentOnboarding.answers
                            }
                        })
                    });
                    
                    if (!response.ok) throw new Error('API response not ok');
                    
                    var data = await response.json();
                    return {
                        title: '',
                        content: cleanText(data.answer),
                        related: data.related || []
                    };
                } else {
                    // Supabase 직접 연결
                    return await searchSupabaseDirect(query);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                return fallbackSearch(query);
            }
        }
        
        // 깨진 문자 정리 함수
        function cleanText(text) {
            if (!text) return '';
            // 깨진 이모지/유니코드 제거 (replacement character)
            text = text.replace(/[\uFFFD�]+/g, '');
            // 연속된 공백 정리
            text = text.replace(/\s{2,}/g, ' ');
            return text.trim();
        }
        
        // Supabase 직접 검색 (API 배포 전 테스트용)
        async function searchSupabaseDirect(query) {
            const searchTerm = query.trim().toLowerCase();
            
            // 키워드 매핑
            const keywordMap = {
                '젖몸살': ['젖몸살', '울혈', '유방울혈', '통증'],
                '유선염': ['유선염', '열', '감염', '항생제'],
                '젖양': ['젖양', '모유량', '부족', '늘리기'],
                '밤수유': ['밤수유', '야간수유', '수면'],
                '이유식': ['이유식', '고형식', '시작'],
                '복직': ['복직', '직장', '유축', '워킹맘'],
                '입덧': ['입덧', '오심', '구토'],
                '태교': ['태교', '태담'],
                '산후우울': ['산후우울', '우울증'],
                '황달': ['황달', '신생아'],
                '유두': ['유두', '균열', '상처', '통증'],
                '자세': ['자세', '래치', '물림']
            };
            
            let expandedKeywords = [searchTerm];
            for (const [key, values] of Object.entries(keywordMap)) {
                if (searchTerm.includes(key)) {
                    expandedKeywords = [...expandedKeywords, ...values];
                }
            }
            
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/knowledge_units?select=*`, {
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!response.ok) throw new Error('Supabase error');
                
                let results = await response.json();
                
                // 점수 계산
                results = results.map(item => {
                    let score = 0;
                    const title = (item.title || '').toLowerCase();
                    const content = (item.content || '').toLowerCase();
                    const keywords = Array.isArray(item.keywords) ? item.keywords.join(' ').toLowerCase() : '';
                    
                    for (const kw of expandedKeywords) {
                        if (title.includes(kw)) score += 10;
                        if (content.includes(kw)) score += 5;
                        if (keywords.includes(kw)) score += 8;
                    }
                    
                    if (item.urgency === '즉시대응필요') score += 3;
                    
                    return { ...item, score };
                });
                
                // 필터링 및 정렬
                results = results
                    .filter(item => item.score > 0 && item.content && item.content.length >= 50)
                    .sort((a, b) => b.score - a.score);
                
                if (results.length > 0) {
                    const top = results[0];
                    return {
                        title: top.title || '',
                        content: top.content || '',
                        related: results.slice(1, 4).map(r => r.title)
                    };
                }
                
                return null;
            } catch (error) {
                console.error('Supabase direct search error:', error);
                return null;
            }
        }
        
        // 폴백 검색 (RAG 실패 시 로컬 키워드 매칭)
        // 풍부한 FAQ 콘텐츠 데이터베이스
        var faqDatabase = {
            // ==================== 긴급/SOS ====================
            '젖몸살': {
                title: '🚨 젖몸살 대처법',
                content: '젖몸살은 출산 후 3-5일에 흔히 발생해요. 24시간 내 대처가 중요해요!\n\n✅ 즉시 해야 할 것:\n• 자주 수유하기 (2시간마다)\n• 수유 전 따뜻한 찜질 (5분)\n• 부드럽게 유방 마사지 (겨드랑이→유두 방향)\n• 수유 후 차가운 찜질\n\n⚠️ 병원 방문이 필요한 경우:\n• 38도 이상 열이 12시간 이상\n• 빨갛게 부어오름\n• 고름이 나오거나 심한 통증\n\n젖몸살을 방치하면 유선염으로 발전할 수 있어요!',
                related: ['유선염', '젖물림', '수유자세'],
                urgency: 'high'
            },
            '울혈': {
                title: '🚨 유방 울혈 대처법',
                content: '유방 울혈은 젖이 고여서 가슴이 단단해지고 아픈 상태예요.\n\n✅ 대처법:\n• 자주 수유하기 (2시간마다)\n• 따뜻한 찜질 후 마사지\n• 양배추 잎 냉찜질 (민간요법)\n• 편한 브라 착용\n\n💡 예방법:\n• 수유 건너뛰지 않기\n• 양쪽 균형있게 수유\n• 수유 후 젖이 남으면 짜내기',
                related: ['젖몸살', '유선염', '마사지'],
                urgency: 'high'
            },
            '유선염': {
                title: '🚨 유선염 증상과 치료',
                content: '유선염은 세균 감염으로 인한 유방 염증이에요. 빠른 치료가 필요해요!\n\n🔴 유선염 증상:\n• 38도 이상 고열\n• 유방의 일부가 빨갛고 뜨거움\n• 심한 통증 (만지면 아픔)\n• 몸살, 오한, 피로감\n\n✅ 치료:\n• 항생제 복용 (10-14일) - 수유 중에도 안전해요!\n• 오히려 자주 수유해야 빨리 회복돼요\n• 충분한 휴식과 수분 섭취\n\n⚠️ 젖몸살 vs 유선염:\n• 젖몸살: 양쪽, 열 없음\n• 유선염: 한쪽, 고열, 빨간 부위',
                related: ['젖몸살', '항생제', '열'],
                urgency: 'high'
            },
            '유두출혈': {
                title: '🚨 유두에서 피가 나요',
                content: '소량의 출혈은 수유해도 괜찮아요. 아기가 소량의 혈액을 먹어도 해롭지 않아요.\n\n🔍 원인:\n• 잘못된 젖물림 자세\n• 유두 상처\n• 건조함\n\n✅ 대처법:\n• 젖물림 자세 점검\n• 출혈이 심하면 해당 쪽 휴식\n• 모유를 유두에 발라 자연 치유\n• 유두 보호 크림(라놀린) 사용\n\n⚠️ 병원 방문:\n• 출혈이 멈추지 않을 때\n• 고름이 나올 때',
                related: ['젖물림', '유두상처', '수유자세'],
                urgency: 'high'
            },
            '열': {
                title: '🚨 수유 중 열이 나요',
                content: '수유 중 발열은 유선염의 신호일 수 있어요!\n\n🌡️ 체크포인트:\n• 체온이 38도 이상인가요?\n• 유방의 일부가 빨갛고 아픈가요?\n• 12시간 이상 지속되나요?\n\n✅ 즉시 해야 할 것:\n• 해열제 복용 (타이레놀 - 수유 중 안전)\n• 충분한 수분 섭취\n• 자주 수유하기\n• 휴식\n\n⚠️ 병원 방문이 필요한 경우:\n• 38도 이상 12시간 이상 지속\n• 유방이 빨갛게 부어오름\n• 오한, 몸살 증상',
                related: ['유선염', '젖몸살', '해열제'],
                urgency: 'high'
            },
            
            // ==================== 모유수유 기본 ====================
            '모유': {
                title: '💚 모유수유 기본 가이드',
                content: '모유수유는 아기와 엄마 모두에게 많은 이점이 있어요!\n\n🌟 모유의 장점:\n• 아기: 면역력 강화, 소화 용이, 알레르기 예방\n• 엄마: 자궁 수축, 체중 감소, 유대감 형성\n\n📝 성공적인 수유를 위해:\n• 출산 후 1시간 내 첫 수유\n• 하루 8-12회 자주 수유\n• 올바른 젖물림과 편안한 자세\n• 충분한 수분과 영양 섭취\n\n💡 기억하세요:\n• 처음엔 누구나 서툴러요\n• 도움을 요청하는 것은 좋은 엄마의 자세예요\n• 아기와 엄마의 페이스를 존중하세요',
                related: ['젖물림', '수유자세', '젖양'],
                urgency: 'normal'
            },
            '젖물림': {
                title: '🤱 올바른 젖물림 방법',
                content: '올바른 젖물림은 통증 없는 수유의 핵심이에요!\n\n🎯 올바른 젖물림 체크:\n• 아기 입이 크게 벌어짐 (140도 이상)\n• 유륜 대부분이 아기 입 안에\n• 아래 입술이 뒤집어짐\n• 턱이 유방에 닿음\n• 코는 유방에서 살짝 떨어짐\n\n❌ 잘못된 젖물림 신호:\n• 젖꼭지만 물고 있음\n• 딸깍딸깍 소리\n• 수유 시 통증 (처음 몇 초 제외)\n• 아기가 금방 지침\n\n💡 팁:\n• 아기를 엄마 쪽으로 (엄마가 숙이지 않기)\n• 아기 귀-어깨-엉덩이 일직선\n• 배와 배가 마주보게',
                related: ['수유자세', '유두통증', '모유'],
                urgency: 'normal'
            },
            '수유자세': {
                title: '🤱 편안한 수유 자세',
                content: '자신에게 맞는 수유 자세를 찾아보세요!\n\n1️⃣ 요람 안기 (기본)\n• 아기 머리를 팔꿈치에\n• 가장 흔한 자세\n\n2️⃣ 교차 요람\n• 반대쪽 손으로 아기 머리 지지\n• 신생아에게 좋음\n\n3️⃣ 풋볼 자세\n• 아기를 옆구리 아래로\n• 제왕절개, 큰 가슴에 좋음\n\n4️⃣ 옆으로 누워\n• 밤수유에 편함\n• 제왕절개 후 좋음\n\n💡 공통 원칙:\n• 엄마 허리는 편하게\n• 쿠션 활용하기\n• 아기를 엄마 쪽으로 가져오기',
                related: ['젖물림', '밤수유', '제왕절개'],
                urgency: 'normal'
            },
            '젖양': {
                title: '💧 젖양이 부족한 것 같아요',
                content: '많은 엄마들이 걱정하시는 부분이에요. 진짜 부족한지 먼저 확인해볼까요?\n\n✅ 충분히 먹고 있다는 신호:\n• 하루 소변 6회 이상\n• 체중이 정상적으로 늘어남\n• 수유 후 만족해 보임\n\n❌ 실제 부족할 때:\n• 소변 6회 미만\n• 체중 증가가 거의 없음\n• 항상 배고파 보임\n\n💪 젖양 늘리는 방법:\n• 자주 수유하기 (8-12회/일)\n• 밤수유 유지하기\n• 양쪽 완전히 비우기\n• 충분한 수분 섭취 (2-3L)\n• 휴식과 스트레스 관리\n\n💡 성장급등기(2주, 6주, 3개월)에는 갑자기 많이 먹어요. 2-3일 지나면 젖양이 맞춰져요!',
                related: ['밤수유', '유축', '성장급등기'],
                urgency: 'normal'
            },
            '초유': {
                title: '🌟 초유의 중요성',
                content: '초유는 출산 후 2-5일간 나오는 황금빛 첫 모유예요!\n\n💛 초유의 특징:\n• 진한 노란색/주황색\n• 양은 적지만 영양 농축\n• 아기 위 크기에 딱 맞는 양\n\n🛡️ 초유의 효과:\n• 면역 물질 풍부 (아기의 첫 백신!)\n• 태변 배출 도움\n• 황달 예방\n• 장 발달 촉진\n\n📝 첫날 위 크기:\n• 1일: 체리 크기 (5-7ml)\n• 3일: 호두 크기 (22-27ml)\n• 7일: 살구 크기 (45-60ml)\n\n💡 "젖이 안 나와요" 걱정 마세요!\n초유의 양은 원래 적어요. 아기에게 딱 맞게 설계된 거예요!',
                related: ['젖양', '신생아수유', '모유'],
                urgency: 'normal'
            },
            
            // ==================== 밤수유/수면 ====================
            '밤수유': {
                title: '🌙 밤수유 가이드',
                content: '밤수유가 힘드시죠? 하지만 중요한 이유가 있어요!\n\n🌙 밤수유가 중요한 이유:\n• 프로락틴(젖 생성 호르몬)이 밤에 가장 높아요\n• 젖양 유지에 필수\n• 아기 성장 호르몬도 밤에 분비\n\n📊 월령별 밤수유 횟수:\n• 0-3개월: 2-4회\n• 3-6개월: 1-3회\n• 6개월 이후: 0-2회\n\n💤 덜 힘들게 하는 방법:\n• 옆으로 누워 수유하기\n• 아기 침대를 가까이\n• 조명은 최소한으로\n• 기저귀/트림은 아빠가\n\n⏰ 밤수유 줄이는 시기:\n• 아기 체중 6kg 이상\n• 6개월 이후\n• 밤에 5-6시간 잘 때',
                related: ['수면', '젖양', '수유자세'],
                urgency: 'normal'
            },
            '수면': {
                title: '😴 아기 수면 패턴',
                content: '신생아의 수면은 어른과 달라요!\n\n📊 월령별 수면:\n• 0-3개월: 14-17시간 (2-4시간씩)\n• 3-6개월: 12-15시간 (점점 길어짐)\n• 6-12개월: 12-14시간 (밤잠 길어짐)\n\n🛏️ 건강한 수면 습관:\n• 낮과 밤 구분해주기\n• 일정한 취침 루틴\n• 졸릴 때 눕히기 (완전히 잠든 후 X)\n• 백색소음 활용\n\n⚠️ 안전한 수면 환경:\n• 단단한 매트리스\n• 베개, 이불 사용 금지\n• 바로 눕히기 (엎드려 재우기 X)\n• 적정 실내 온도 (20-22도)',
                related: ['밤수유', '수면교육', '백색소음'],
                urgency: 'normal'
            },
            
            // ==================== 이유식 ====================
            '이유식': {
                title: '🥄 이유식 시작 가이드',
                content: '이유식은 만 6개월 전후에 시작해요!\n\n✅ 시작 신호:\n• 목을 가눌 수 있음\n• 음식에 관심을 보임\n• 혀 내밀기 반사가 줄어듦\n• 앉힐 때 상체를 지탱함\n\n📝 단계별 진행:\n1️⃣ 초기 (6개월~)\n• 쌀미음부터 시작\n• 한 가지씩 3일간 테스트\n• 채소 → 과일 → 고기 순서\n\n2️⃣ 중기 (7-8개월)\n• 으깬 형태\n• 하루 2회\n\n3️⃣ 후기 (9-11개월)\n• 잘게 다진 형태\n• 하루 3회\n\n⚠️ 주의사항:\n• 돌 전: 꿀, 생우유 금지\n• 알레르기 식품은 소량씩\n• 모유/분유는 계속 유지',
                related: ['알레르기', '모유', '성장'],
                urgency: 'normal'
            },
            '알레르기': {
                title: '🚫 이유식 알레르기 관리',
                content: '새로운 음식을 시작할 때는 알레르기 주의가 필요해요!\n\n🔴 주요 알레르기 식품:\n• 계란, 우유, 밀\n• 땅콩, 견과류\n• 생선, 갑각류, 조개\n• 대두\n\n📝 안전하게 시작하기:\n• 한 가지씩 3-5일 간격으로\n• 소량부터 시작\n• 오전에 시도 (반응 관찰)\n• 새 음식 기록하기\n\n⚠️ 알레르기 증상:\n• 두드러기, 발진\n• 입술/혀 부음\n• 구토, 설사\n• 호흡 곤란 (심각)\n\n🚨 응급 상황:\n• 호흡 곤란, 전신 두드러기\n• 즉시 119 신고',
                related: ['이유식', '두드러기', '응급'],
                urgency: 'normal'
            },
            
            // ==================== 복직/유축 ====================
            '복직': {
                title: '👔 복직 준비하기',
                content: '복직 후에도 모유수유를 계속할 수 있어요!\n\n📅 복직 전 준비 (2-4주 전):\n• 유축기 사용 연습\n• 모유 저장 시작\n• 젖병 수유 연습 (유두혼란 주의)\n• 직장 내 수유실 확인\n\n🏢 복직 후 유축:\n• 3-4시간마다 유축\n• 점심시간 + 휴식시간 활용\n• 유축한 모유는 아이스팩과 함께 보관\n\n❄️ 모유 보관:\n• 실온: 4시간\n• 냉장: 4일\n• 냉동: 6개월\n\n💡 팁:\n• 손 유축도 배워두세요\n• 여분의 옷 준비\n• 유축 일정 미리 공유',
                related: ['유축', '모유보관', '젖병'],
                urgency: 'normal'
            },
            '유축': {
                title: '🍼 유축 방법과 팁',
                content: '유축은 모유수유를 유지하면서 외출이나 복직을 가능하게 해요!\n\n🔧 유축기 종류:\n• 수동: 저렴, 조용, 손이 피로\n• 전동 싱글: 편리, 적당한 가격\n• 전동 더블: 시간 절약, 젖양 유지에 효과적\n\n⏰ 유축 타이밍:\n• 아침 수유 후 (젖양 가장 많음)\n• 수유 사이 30분~1시간 후\n• 복직 후: 3-4시간마다\n\n💡 유축 팁:\n• 따뜻한 찜질 후 시작\n• 아기 사진 보며 유축\n• 편안한 자세로\n• 한쪽 15-20분\n\n🧴 유축기 관리:\n• 사용 후 바로 세척\n• 하루 1회 소독\n• 부품 정기 교체',
                related: ['복직', '모유보관', '젖양'],
                urgency: 'normal'
            },
            '모유보관': {
                title: '❄️ 모유 보관과 해동',
                content: '유축한 모유를 안전하게 보관하는 방법이에요!\n\n⏰ 보관 기간:\n• 실온 (25도): 4시간\n• 냉장 (4도): 4일 (권장) ~ 8일\n• 냉동 (-18도): 6개월 (권장) ~ 12개월\n\n📦 보관 용기:\n• 모유 전용 팩\n• BPA-free 용기\n• 유리병\n\n💡 보관 팁:\n• 날짜/시간 기록\n• 60-120ml씩 소분\n• 냉장고 안쪽에 보관 (문쪽 X)\n• 냉동 시 여유 공간 남기기\n\n🔥 해동 방법:\n• 냉장 해동 (전날 밤 이동)\n• 미지근한 물에 담그기\n• ❌ 전자레인지 금지\n• ❌ 끓는 물 금지\n\n♻️ 해동 후: 24시간 내 사용, 재냉동 금지',
                related: ['유축', '복직', '젖병'],
                urgency: 'normal'
            },
            
            // ==================== 단유 ====================
            '단유': {
                title: '🌅 단유 방법',
                content: '단유는 엄마와 아기 모두 준비가 됐을 때 천천히 진행해요.\n\n🕐 적정 시기:\n• WHO 권장: 2년까지\n• 한국 평균: 12-18개월\n• 정답은 없어요!\n\n📝 점진적 단유 (권장):\n1. 가장 덜 중요한 수유부터 빼기\n2. 3-4일마다 하나씩 줄이기\n3. 마지막에 잠자리 수유 끊기\n4. 전체 2-4주 소요\n\n💆 엄마 케어:\n• 불편하면 조금씩만 짜기\n• 차가운 찜질\n• 꽉 조이는 브라 피하기\n• 호르몬 변화로 감정 기복 있을 수 있어요\n\n👶 아기 케어:\n• 스킨십으로 안정감 주기\n• 대체 활동 찾기 (책 읽기 등)\n• 아빠가 재우기 시도',
                related: ['밤수유', '젖몸살', '아기수면'],
                urgency: 'normal'
            },
            
            // ==================== 아기 건강 ====================
            '아기열': {
                title: '🌡️ 아기가 열이 나요',
                content: '아기 발열은 주의가 필요해요!\n\n🌡️ 체온 기준:\n• 37.5도 이상 (겨드랑이): 발열\n• 38도 이상 (귀/항문): 발열\n\n🚨 즉시 응급실 (0-3개월):\n• 38도 이상 발열\n• 잘 안 먹고 처짐\n• 호흡 곤란\n\n⚠️ 소아과 방문 (3개월 이상):\n• 38.5도 이상\n• 열이 3일 이상 지속\n• 발진 동반\n• 평소와 다르게 보챔\n\n🏠 집에서 할 수 있는 것:\n• 미지근한 물수건으로 닦기\n• 얇은 옷으로 갈아입히기\n• 수분 섭취 (모유/분유/물)\n• 해열제 (3개월 이상, 용량 확인)\n\n※ 3개월 미만은 해열제 사용 전 의사 상담!',
                related: ['응급', '해열제', '병원'],
                urgency: 'high'
            },
            '예방접종': {
                title: '💉 예방접종 일정',
                content: '예방접종은 아기를 지키는 중요한 방패예요!\n\n📅 필수 예방접종:\n\n🔹 출생 시:\n• B형간염 1차, BCG(결핵)\n\n🔹 1개월:\n• B형간염 2차\n\n🔹 2개월:\n• DTaP, IPV, 뇌수막염, 폐렴구균 1차\n• 로타바이러스 1차\n\n🔹 4개월:\n• DTaP, IPV, 뇌수막염, 폐렴구균 2차\n\n🔹 6개월:\n• DTaP, B형간염, 뇌수막염, 폐렴구균 3차\n• 독감 (매년)\n\n🔹 12-15개월:\n• MMR, 수두, 일본뇌염, A형간염\n\n📱 "예방접종도우미" 앱 활용하세요!',
                related: ['아기건강', '소아과', '발달'],
                urgency: 'normal'
            },
            '황달': {
                title: '💛 신생아 황달',
                content: '신생아 황달은 흔하지만 관찰이 필요해요!\n\n🔍 황달이란?\n• 빌리루빈 수치가 높아져 피부/눈이 노랗게 됨\n• 생후 2-3일에 나타나 1-2주 내 호전\n\n✅ 정상 범위의 황달:\n• 얼굴만 약간 노란색\n• 잘 먹고 잘 잠\n• 기저귀 잘 적심\n\n⚠️ 병원 방문 필요:\n• 생후 24시간 내 황달\n• 몸통, 팔다리까지 노란색\n• 잘 안 먹고 처짐\n• 2주 이상 지속\n\n💡 예방/관리:\n• 자주 수유하기 (8-12회/일)\n• 햇빛 쬐기 (간접 햇빛, 눈 보호)\n• 모유 황달은 수유 중단 필요 없음',
                related: ['신생아', '모유', '병원'],
                urgency: 'normal'
            },
            
            // ==================== 정서/심리 ====================
            '우울': {
                title: '💙 산후 우울감',
                content: '출산 후 감정 변화는 매우 자연스러운 거예요.\n\n💙 종류:\n\n1️⃣ 베이비 블루스 (70-80%):\n• 출산 후 3-5일 시작\n• 2주 내 자연 회복\n• 눈물, 예민함, 불안\n\n2️⃣ 산후 우울증 (10-15%):\n• 2주 이상 지속\n• 일상생활이 어려움\n• 전문 상담/치료 필요\n\n⚠️ 도움이 필요한 신호:\n• 아기에게 무관심하거나 두려움\n• 2주 이상 우울감 지속\n• 자해 생각\n\n🆘 24시간 상담:\n• 정신건강위기상담: 1577-0199\n• 자살예방상담: 1393\n\n💚 당신은 좋은 엄마예요. 도움을 받는 것도 용기예요.',
                related: ['스트레스', '힘들어요', '상담'],
                urgency: 'high'
            },
            '힘들어': {
                title: '💚 지금 많이 힘드시죠?',
                content: '육아가 힘든 건 당연한 거예요. 당신의 감정은 타당해요.\n\n🫂 괜찮아요:\n• 완벽한 엄마는 없어요\n• 힘들다고 느끼는 건 정상이에요\n• 도움을 요청하는 건 좋은 엄마의 자세예요\n\n💡 지금 할 수 있는 것:\n• 잠깐이라도 쉬세요\n• 누군가에게 마음을 털어놓으세요\n• 아기가 안전한 곳에 있다면 잠시 나와서 심호흡\n\n🤝 도움받을 수 있는 곳:\n• 가족, 친구에게 부탁하기\n• 산후조리원/산후도우미\n• 정신건강복지센터 (무료 상담)\n• 정신건강위기상담: 1577-0199\n\n💕 혼자가 아니에요. 맘곁이 함께할게요.',
                related: ['우울', '휴식', '상담'],
                urgency: 'high'
            },
            
            // ==================== 임신 관련 ====================
            '입덧': {
                title: '🤢 입덧 완화 방법',
                content: '입덧은 임신 6-8주에 시작해 12-14주 사이에 호전돼요.\n\n🌿 완화 방법:\n• 공복 피하기 - 소량씩 자주\n• 아침에 일어나기 전 크래커 먼저\n• 기름진 음식, 향이 강한 음식 피하기\n• 생강차, 레몬수\n• 비타민 B6 (의사 상담 후)\n\n⚠️ 병원 방문 필요:\n• 하루 3회 이상 구토\n• 소변량 감소/진한 색\n• 3kg 이상 체중 감소\n• 심한 어지러움\n\n💚 입덧이 심해도 태아는 잘 자라고 있어요!',
                related: ['임신초기', '영양', '엽산'],
                urgency: 'normal'
            },
            '엽산': {
                title: '💊 엽산 복용 가이드',
                content: '엽산은 태아 신경관 발달에 필수예요!\n\n📅 복용 시기:\n• 임신 3개월 전부터\n• 필수: 임신 12주까지\n• 권장: 임신 전 기간/수유 중\n\n💊 권장 용량:\n• 일반: 400-800mcg/일\n• 고위험군: 4mg/일 (의사 처방)\n\n🥬 엽산 풍부한 음식:\n• 시금치, 브로콜리\n• 콩류, 렌틸콩\n• 아보카도, 오렌지\n• 강화 시리얼\n\n💡 엽산은 열에 약해요!\n채소는 살짝 익히거나 생으로 드세요.',
                related: ['임신준비', '영양제', '임신초기'],
                urgency: 'normal'
            },
            '태동': {
                title: '👶 태동 느끼기',
                content: '태동은 아기가 건강하다는 신호예요!\n\n📅 시작 시기:\n• 초산모: 18-22주\n• 경산모: 16-20주\n• 처음엔 "뽀글뽀글" 같은 미세한 느낌\n\n✅ 정상적인 태동:\n• 하루 10회 이상 (28주 이후)\n• 식후나 옆으로 누웠을 때 더 잘 느껴짐\n• 아기도 수면 주기가 있어 20-40분 조용할 수 있음\n\n⚠️ 병원 연락:\n• 평소보다 태동이 현저히 줄었을 때\n• 28주 이후 하루 동안 태동을 못 느낄 때\n• 갑자기 태동이 멈췄을 때',
                related: ['임신중기', '아기건강', '검진'],
                urgency: 'normal'
            },
            '진통': {
                title: '🏥 진통 vs 가진통',
                content: '진짜 진통인지 구별하는 방법이에요!\n\n🔴 진짜 진통:\n• 규칙적으로 점점 강해짐\n• 간격이 점점 짧아짐 (10분→5분→3분)\n• 자세 바꿔도 계속됨\n• 허리와 배 전체로 퍼지는 통증\n\n⚪ 가진통 (브랙스톤 힉스):\n• 불규칙함\n• 강도가 일정하거나 약해짐\n• 자세 바꾸면 사라지기도 함\n• 배가 단단해지는 느낌\n\n🏥 병원 갈 때:\n• 진통 5분 간격으로 1시간 이상\n• 양수가 터졌을 때\n• 출혈이 있을 때\n• 태동이 급격히 줄었을 때\n\n📝 진통 간격을 기록해두세요!',
                related: ['출산', '양수', '분만'],
                urgency: 'high'
            }
        };
        
        function fallbackSearch(query) {
            var lowerQuery = query.toLowerCase();
            var bestMatch = null;
            var bestScore = 0;
            
            // 키워드 매칭
            for (var key in faqDatabase) {
                var score = 0;
                
                // 직접 키워드 매칭
                if (lowerQuery.includes(key)) {
                    score = 10;
                }
                
                // 제목에서 매칭
                var item = faqDatabase[key];
                if (item.title && item.title.toLowerCase().includes(lowerQuery)) {
                    score += 5;
                }
                
                // 관련 키워드 매칭
                if (item.related) {
                    for (var i = 0; i < item.related.length; i++) {
                        if (lowerQuery.includes(item.related[i].toLowerCase())) {
                            score += 3;
                        }
                    }
                }
                
                // 유사 키워드 매칭
                var synonyms = {
                    '젖': ['젖몸살', '젖양', '모유'],
                    '아파': ['젖몸살', '유선염', '유두출혈'],
                    '안나와': ['젖양'],
                    '적어': ['젖양'],
                    '많이먹': ['성장급등기', '젖양'],
                    '열나': ['열', '아기열', '유선염'],
                    '잠': ['밤수유', '수면'],
                    '피곤': ['힘들어', '우울'],
                    '울어': ['우울', '힘들어'],
                    '토해': ['입덧'],
                    '움직': ['태동'],
                    '아플': ['진통']
                };
                
                for (var syn in synonyms) {
                    if (lowerQuery.includes(syn)) {
                        var targets = synonyms[syn];
                        for (var j = 0; j < targets.length; j++) {
                            if (key === targets[j] || key.includes(targets[j])) {
                                score += 2;
                            }
                        }
                    }
                }
                
                if (score > bestScore) {
                    bestScore = score;
                    bestMatch = item;
                }
            }
            
            if (bestMatch && bestScore >= 2) {
                return {
                    title: bestMatch.title,
                    content: bestMatch.content,
                    related: bestMatch.related || []
                };
            }
            
            return null;
        }
        
        // 봇 메시지 포맷팅
        function formatBotMessage(icon, response) {
            var content = response.content || '';
            var title = response.title || '';
            var relatedTopics = response.related || [];
            
            var html = `
                <div class="message bot">
                    <div class="message-avatar">${icon}</div>
                    <div class="message-content">
            `;
            
            if (title) {
                html += `<p class="answer-title"><strong>${escapeHtml(title)}</strong></p>`;
            }
            
            // 내용을 문단으로 분리
            var paragraphs = content.split('\n').filter(function(p) { return p.trim(); });
            paragraphs.forEach(function(p) {
                // 마크다운 처리
                var formattedText = formatMarkdown(escapeHtml(p));
                html += `<p>${formattedText}</p>`;
            });
            
            // 관련 주제
            if (relatedTopics.length > 0) {
                html += `<div class="related-topics">`;
                html += `<p class="related-label">관련 정보:</p>`;
                relatedTopics.forEach(function(topic) {
                    html += `<button class="related-btn" onclick="searchRelated('${escapeHtml(topic)}')">${escapeHtml(topic)}</button>`;
                });
                html += `</div>`;
            }
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }
        
        // 마크다운 변환 함수
        function formatMarkdown(text) {
            // **텍스트** -> <strong>텍스트</strong>
            text = text.replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');
            // *텍스트* -> <em>텍스트</em>
            text = text.replace(/\*([^*]+)\*/g, '<em>$1</em>');
            // 깨진 이모지 (placeholder) 제거/대체
            text = text.replace(/[\uFFFD�]+/g, '');
            return text;
        }
        
        // 관련 주제 검색
        function searchRelated(topic) {
            document.getElementById('chatInput').value = topic;
            sendMessage();
        }
        
        // HTML 이스케이프
        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ==================== 음성 인식 ====================
        var recognition = null;
        var isRecording = false;
        
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'ko-KR';
                recognition.continuous = false;
                recognition.interimResults = true;
                
                recognition.onstart = function() {
                    isRecording = true;
                    document.getElementById('micBtn').classList.add('recording');
                    document.getElementById('recordingIndicator').classList.add('active');
                    document.getElementById('chatInput').placeholder = '말씀하세요...';
                };
                
                recognition.onresult = function(event) {
                    var finalTranscript = '';
                    var interimTranscript = '';
                    
                    for (var i = event.resultIndex; i < event.results.length; i++) {
                        var transcript = event.results[i][0].transcript;
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                        } else {
                            interimTranscript += transcript;
                        }
                    }
                    
                    // 입력창에 실시간 표시
                    document.getElementById('chatInput').value = finalTranscript || interimTranscript;
                };
                
                recognition.onend = function() {
                    isRecording = false;
                    document.getElementById('micBtn').classList.remove('recording');
                    document.getElementById('recordingIndicator').classList.remove('active');
                    document.getElementById('chatInput').placeholder = '메시지를 입력하세요...';
                    document.getElementById('chatInput').focus();
                    
                    // 텍스트가 있으면 자동 전송 (선택사항)
                    // var text = document.getElementById('chatInput').value.trim();
                    // if (text) sendMessage();
                };
                
                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    isRecording = false;
                    document.getElementById('micBtn').classList.remove('recording');
                    document.getElementById('recordingIndicator').classList.remove('active');
                    document.getElementById('chatInput').placeholder = '메시지를 입력하세요...';
                    
                    var message = '다시 시도해주세요';
                    if (event.error === 'not-allowed') {
                        message = '마이크 권한을 허용해주세요';
                    } else if (event.error === 'no-speech') {
                        message = '음성이 감지되지 않았어요';
                    } else if (event.error === 'audio-capture') {
                        message = '마이크를 확인해주세요';
                    }
                    alert(message);
                };
                
                return true;
            }
            return false;
        }
        
        function toggleRecording() {
            if (!recognition) {
                if (!initSpeechRecognition()) {
                    alert('이 브라우저에서는 음성 입력을 지원하지 않아요');
                    return;
                }
            }
            
            if (isRecording) {
                recognition.stop();
            } else {
                try {
                    recognition.start();
                } catch (e) {
                    recognition.stop();
                    setTimeout(function() {
                        recognition.start();
                    }, 100);
                }
            }
        }
        
        // 이벤트 리스너 등록 (DOM 로드 후)
        document.addEventListener('DOMContentLoaded', function() {
            // 인트로 → 로그인
            document.querySelector('.intro-btn').addEventListener('click', showLogin);
            
            // 로그인 화면 뒤로가기
            document.querySelector('.login-screen .back-btn').addEventListener('click', showIntro);
            
            // 게스트 로그인
            document.querySelector('.login-btn-guest').addEventListener('click', guestLogin);
            
            // 소셜 로그인
            document.querySelector('.login-btn-kakao').addEventListener('click', function() { loginWith('카카오'); });
            document.querySelector('.login-btn-google').addEventListener('click', function() { loginWith('Google'); });
            document.querySelector('.login-btn-apple').addEventListener('click', function() { loginWith('Apple'); });
            
            // 맘곁 카드들 - 온보딩으로 연결
            document.getElementById('cardSaessak').addEventListener('click', function() {
                selectMate('saessak');
            });
            document.getElementById('cardYebi').addEventListener('click', function() {
                selectMate('yebi');
            });
            document.getElementById('cardAgi').addEventListener('click', function() {
                selectMate('agi');
            });
            document.getElementById('cardExpert').addEventListener('click', function() {
                selectMate('expert');
            });
            
            // 온보딩 뒤로가기
            document.getElementById('onboardingBackBtn').addEventListener('click', function() {
                if (currentOnboarding.step > 0) {
                    currentOnboarding.step--;
                    currentOnboarding.answers.pop();
                    renderOnboardingStep();
                } else {
                    showHome();
                }
            });
            
            // 채팅 뒤로가기
            document.getElementById('chatBackBtn').addEventListener('click', showHome);
            
            // 메시지 전송
            document.getElementById('sendBtn').addEventListener('click', sendMessage);
            document.getElementById('chatInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendMessage();
            });
            
            // 마이크 버튼 (음성 인식)
            document.getElementById('micBtn').addEventListener('click', toggleRecording);
            
            // ===== 홈 화면 네비게이션 =====
            document.getElementById('navHome').addEventListener('click', showHome);
            document.getElementById('navCalendar').addEventListener('click', showCalendar);
            document.getElementById('navChat').addEventListener('click', function() {
                showChat('default', '🤱', '맘곁');
            });
            document.getElementById('navMy').addEventListener('click', showMyPage);
            
            // 홈 헤더 아이콘 (햄버거, 알림)
            document.getElementById('homeMenuBtn').addEventListener('click', openSideMenu);
            document.getElementById('homeNotiBtn').addEventListener('click', showNotification);
            
            // ===== 캘린더 화면 네비게이션 =====
            document.getElementById('calNavHome').addEventListener('click', showHome);
            document.getElementById('calNavCalendar').addEventListener('click', showCalendar);
            document.getElementById('calNavChat').addEventListener('click', function() {
                showChat('default', '🤱', '맘곁');
            });
            document.getElementById('calNavMy').addEventListener('click', showMyPage);
            document.getElementById('calMenuBtn').addEventListener('click', openSideMenu);
            document.getElementById('calNotiBtn').addEventListener('click', showNotification);
            
            // 캘린더 월 이동 버튼
            document.getElementById('prevMonth').addEventListener('click', prevCalendarMonth);
            document.getElementById('nextMonth').addEventListener('click', nextCalendarMonth);
            
            // ===== 마이페이지 네비게이션 =====
            document.getElementById('myNavHome').addEventListener('click', showHome);
            document.getElementById('myNavCalendar').addEventListener('click', showCalendar);
            document.getElementById('myNavChat').addEventListener('click', function() {
                showChat('default', '🤱', '맘곁');
            });
            document.getElementById('myNavMy').addEventListener('click', showMyPage);
            document.getElementById('myMenuBtn').addEventListener('click', openSideMenu);
            document.getElementById('myNotiBtn').addEventListener('click', showNotification);
            
            // ===== 알림 화면 뒤로가기 =====
            document.getElementById('notiBackBtn').addEventListener('click', showHome);
            
            // ===== 알림 아이템 클릭 =====
            document.getElementById('notiChat').addEventListener('click', function() {
                showChat('default', '🤱', '맘곁');
            });
            document.getElementById('notiCalendar').addEventListener('click', showCalendar);
            document.getElementById('notiWelcome').addEventListener('click', showHome);
            
            // ===== 사이드 메뉴 =====
            document.getElementById('closeMenuBtn').addEventListener('click', closeSideMenu);
            document.getElementById('sideMenuOverlay').addEventListener('click', closeSideMenu);
            
            document.getElementById('sideHome').addEventListener('click', showHome);
            document.getElementById('sideCalendar').addEventListener('click', showCalendar);
            
            // 대화 기록
            document.getElementById('sideHistory').addEventListener('click', function() {
                closeSideMenu();
                alert('대화 기록 기능은 준비 중이에요!');
            });
            
            // 저장한 답변
            document.getElementById('sideSaved').addEventListener('click', function() {
                closeSideMenu();
                alert('저장한 답변 기능은 준비 중이에요!');
            });
            
            // 설정
            document.getElementById('sideSettings').addEventListener('click', function() {
                closeSideMenu();
                showPage('settingsScreen');
            });
            
            // 로그아웃
            document.getElementById('sideLogout').addEventListener('click', function() {
                closeSideMenu();
                if (confirm('로그아웃 하시겠어요?')) {
                    showIntro();
                }
            });
            
            // 전문가 연결 화면 이벤트
            document.getElementById('expertBackBtn').addEventListener('click', showHome);
            document.getElementById('expertNavHome').addEventListener('click', showHome);
            document.getElementById('expertNavCalendar').addEventListener('click', showCalendar);
            document.getElementById('expertNavChat').addEventListener('click', function() {
                // 마지막 사용한 채팅으로 이동 또는 홈
                showHome();
            });
            document.getElementById('expertNavMy').addEventListener('click', showMyPage);
            
            // 상담 예약 버튼 - 모달 열기
            document.getElementById('reservationBtn').addEventListener('click', function() {
                document.getElementById('reservationModal').classList.remove('hidden');
            });
            
            // 상담 예약 모달 닫기
            document.getElementById('closeReservationBtn').addEventListener('click', closeReservationModal);
            document.getElementById('reservationOverlay').addEventListener('click', closeReservationModal);
            
            function closeReservationModal() {
                document.getElementById('reservationModal').classList.add('hidden');
                document.getElementById('reservationForm').reset();
            }
            
            // 전화번호 자동 포맷
            document.getElementById('resPhone').addEventListener('input', function(e) {
                let value = e.target.value.replace(/[^0-9]/g, '');
                if (value.length > 3 && value.length <= 7) {
                    value = value.slice(0, 3) + '-' + value.slice(3);
                } else if (value.length > 7) {
                    value = value.slice(0, 3) + '-' + value.slice(3, 7) + '-' + value.slice(7, 11);
                }
                e.target.value = value;
            });
            
            // 상담 예약 폼 제출
            document.getElementById('reservationForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const phone = document.getElementById('resPhone').value.trim();
                const nickname = document.getElementById('resNickname').value.trim();
                const babyName = document.getElementById('resBabyName').value.trim();
                const category = document.getElementById('resCategory').value;
                const memo = document.getElementById('resMemo').value.trim();
                
                // 유효성 검사
                if (!phone || phone.length < 12) {
                    alert('올바른 연락처를 입력해주세요.');
                    return;
                }
                if (!nickname) {
                    alert('닉네임을 입력해주세요.');
                    return;
                }
                
                const submitBtn = document.getElementById('submitReservation');
                submitBtn.disabled = true;
                submitBtn.textContent = '예약 중...';
                
                try {
                    // Supabase에 예약 데이터 저장
                    const reservationData = {
                        phone: phone,
                        nickname: nickname,
                        baby_name: babyName || null,
                        category: category,
                        memo: memo || null,
                        status: 'pending',
                        created_at: new Date().toISOString()
                    };
                    
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/consultation_reservations`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                            'Prefer': 'return=representation'
                        },
                        body: JSON.stringify(reservationData)
                    });
                    
                    if (response.ok) {
                        // SMS 알림 발송 (전문가에게)
                        await sendExpertNotification(nickname, phone, category, babyName);
                        
                        closeReservationModal();
                        alert('✅ 상담 예약이 완료되었습니다!\n\n평일 기준 24시간 이내에\n전문 상담사가 연락드릴게요. 💕');
                    } else {
                        throw new Error('예약 저장 실패');
                    }
                } catch (error) {
                    console.error('예약 오류:', error);
                    alert('예약 중 오류가 발생했어요.\n잠시 후 다시 시도해주세요.');
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = '예약 신청하기';
                }
            });
            
            // 전문가에게 SMS 알림 발송
            async function sendExpertNotification(nickname, phone, category, babyName) {
                const expertPhone = '01080202334'; // 테스트용 전화번호
                const message = `[맘곁 상담예약]\n닉네임: ${nickname}\n연락처: ${phone}\n분야: ${category}${babyName ? '\n아기: ' + babyName : ''}\n\n24시간 내 연락 부탁드립니다.`;
                
                try {
                    // Supabase Edge Function 또는 외부 SMS API 호출
                    // 여기서는 알림 로그만 저장 (실제 SMS는 서버사이드에서 처리)
                    await fetch(`${SUPABASE_URL}/rest/v1/notification_logs`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        },
                        body: JSON.stringify({
                            type: 'sms',
                            recipient: expertPhone,
                            message: message,
                            status: 'pending',
                            created_at: new Date().toISOString()
                        })
                    });
                } catch (error) {
                    console.error('알림 발송 오류:', error);
                }
            }
            
            // ==================== 설정 화면 ====================
            document.getElementById('goToSettingsBtn')?.addEventListener('click', function() {
                showPage('settingsScreen');
            });
            
            document.getElementById('settingsBackBtn')?.addEventListener('click', function() {
                showPage('myScreen');
            });
            
            // 다크모드 토글
            const darkModeToggle = document.getElementById('darkModeToggle');
            
            // 저장된 다크모드 설정 불러오기
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                if (darkModeToggle) darkModeToggle.checked = true;
            }
            
            darkModeToggle?.addEventListener('change', function() {
                if (this.checked) {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('darkMode', 'true');
                } else {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('darkMode', 'false');
                }
            });
            
            // ==================== 약관 화면 ====================
            document.getElementById('goToTermsBtn')?.addEventListener('click', function() {
                loadPolicy('terms');
            });
            
            document.getElementById('goToPrivacyBtn')?.addEventListener('click', function() {
                loadPolicy('privacy');
            });
            
            document.getElementById('policyBackBtn')?.addEventListener('click', function() {
                showPage('myScreen');
            });
            
            // 약관 불러오기
            async function loadPolicy(type) {
                const titleEl = document.getElementById('policyTitle');
                const contentEl = document.getElementById('policyContent');
                
                titleEl.textContent = type === 'terms' ? '이용약관' : '개인정보처리방침';
                contentEl.innerHTML = '<div class="policy-loading">불러오는 중...</div>';
                
                showPage('policyScreen');
                
                try {
                    const response = await fetch(`${SUPABASE_URL}/rest/v1/policies?type=eq.${type}&select=*`, {
                        headers: {
                            'apikey': SUPABASE_ANON_KEY,
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                        }
                    });
                    
                    const data = await response.json();
                    
                    if (data && data.length > 0 && data[0].content) {
                        contentEl.innerHTML = data[0].content;
                    } else {
                        // 기본 약관 표시
                        contentEl.innerHTML = getDefaultPolicy(type);
                    }
                } catch (error) {
                    console.error('약관 로드 오류:', error);
                    contentEl.innerHTML = getDefaultPolicy(type);
                }
            }
            
            // 기본 약관 내용
            function getDefaultPolicy(type) {
                if (type === 'terms') {
                    return `
                        <h2>서비스 이용약관</h2>
                        
                        <h3>제1조 (목적)</h3>
                        <p>이 약관은 맘곁(이하 "회사")이 제공하는 육아 AI 동반자 서비스(이하 "서비스")의 이용조건 및 절차, 회사와 이용자의 권리, 의무 및 책임사항 등을 규정함을 목적으로 합니다.</p>
                        
                        <h3>제2조 (정의)</h3>
                        <p>① "서비스"란 회사가 제공하는 AI 기반 육아 상담, 전문가 연결, 정보 제공 등 관련 제반 서비스를 의미합니다.</p>
                        <p>② "이용자"란 본 약관에 따라 회사가 제공하는 서비스를 받는 자를 의미합니다.</p>
                        
                        <h3>제3조 (약관의 효력 및 변경)</h3>
                        <p>① 이 약관은 서비스를 이용하고자 하는 모든 이용자에게 적용됩니다.</p>
                        <p>② 회사는 필요한 경우 관련 법령을 위배하지 않는 범위 내에서 이 약관을 변경할 수 있습니다.</p>
                        
                        <h3>제4조 (서비스의 제공)</h3>
                        <p>① 회사는 다음과 같은 서비스를 제공합니다:</p>
                        <ul>
                            <li>AI 기반 육아 상담 서비스</li>
                            <li>전문가 상담 연결 서비스</li>
                            <li>육아 정보 제공 서비스</li>
                            <li>캘린더 및 일정 관리 서비스</li>
                        </ul>
                        
                        <h3>제5조 (서비스 이용의 제한)</h3>
                        <p>회사는 다음 각 호에 해당하는 경우 서비스 이용을 제한할 수 있습니다:</p>
                        <ul>
                            <li>타인의 정보를 도용하거나 허위 정보를 기재한 경우</li>
                            <li>서비스 운영을 방해한 경우</li>
                            <li>관련 법령에 위배되는 행위를 한 경우</li>
                        </ul>
                        
                        <h3>제6조 (면책조항)</h3>
                        <p>① 회사가 제공하는 정보는 의료적 조언을 대체하지 않으며, 참고용으로만 활용해야 합니다.</p>
                        <p>② 긴급한 의료 상황에서는 반드시 전문 의료기관을 방문하시기 바랍니다.</p>
                        
                        <div class="policy-updated">최종 업데이트: 2026년 1월 1일</div>
                    `;
                } else {
                    return `
                        <h2>개인정보 처리방침</h2>
                        
                        <h3>제1조 (개인정보의 수집 및 이용목적)</h3>
                        <p>맘곁(이하 "회사")은 다음의 목적을 위하여 개인정보를 수집 및 이용합니다:</p>
                        <ul>
                            <li>회원 가입 및 관리</li>
                            <li>서비스 제공 및 개선</li>
                            <li>상담 예약 및 연락</li>
                            <li>맞춤형 정보 제공</li>
                        </ul>
                        
                        <h3>제2조 (수집하는 개인정보의 항목)</h3>
                        <p>회사는 다음과 같은 개인정보를 수집합니다:</p>
                        <ul>
                            <li>필수항목: 닉네임, 연락처</li>
                            <li>선택항목: 아기 이름/태명, 출산예정일, 아기 생년월일</li>
                            <li>자동수집항목: 서비스 이용기록, 접속 로그</li>
                        </ul>
                        
                        <h3>제3조 (개인정보의 보유 및 이용기간)</h3>
                        <p>① 회사는 이용자의 개인정보를 회원 탈퇴 시까지 보유합니다.</p>
                        <p>② 관련 법령에 따라 일정 기간 보관이 필요한 경우 해당 기간 동안 보관합니다.</p>
                        
                        <h3>제4조 (개인정보의 제3자 제공)</h3>
                        <p>회사는 이용자의 동의 없이 개인정보를 제3자에게 제공하지 않습니다. 다만, 다음의 경우는 예외로 합니다:</p>
                        <ul>
                            <li>법령에 의한 요청이 있는 경우</li>
                            <li>이용자가 사전에 동의한 경우</li>
                        </ul>
                        
                        <h3>제5조 (이용자의 권리)</h3>
                        <p>이용자는 언제든지 자신의 개인정보를 조회, 수정, 삭제할 수 있으며, 회원 탈퇴를 요청할 수 있습니다.</p>
                        
                        <h3>제6조 (개인정보 보호책임자)</h3>
                        <p>회사는 개인정보 보호를 위해 개인정보 보호책임자를 지정하고 있습니다.</p>
                        <ul>
                            <li>담당부서: 고객지원팀</li>
                            <li>연락처: help@momgyeot.com</li>
                        </ul>
                        
                        <div class="policy-updated">최종 업데이트: 2026년 1월 1일</div>
                    `;
                }
            }
        });
    </script>
</body>
</html>
